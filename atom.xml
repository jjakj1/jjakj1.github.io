<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>jjakj1&#39;s blog</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2022-08-03T15:26:04.682Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>Shanyu Li</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>â—»ï¸ Widget in iOS</title>
    <link href="http://example.com/2022/08/03/%E2%97%BB%EF%B8%8F%20Widget%20in%20iOS/"/>
    <id>http://example.com/2022/08/03/%E2%97%BB%EF%B8%8F%20Widget%20in%20iOS/</id>
    <published>2022-08-03T14:30:00.000Z</published>
    <updated>2022-08-03T15:26:04.682Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨å¼€å‘ iOS widget çš„è¿‡ç¨‹ä¸­å¯¹ widget çš„ä½¿ç”¨èŒƒå›´å’ŒåŸºæœ¬ç»“æ„æœ‰äº†åŸºæœ¬äº†è§£ï¼ŒåŒæ—¶åœ¨å¼€å‘ä¸­ä¹Ÿé‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œæœ¬æ–‡å¯¹ä»¥ä¸Šå†…å®¹è¿›è¡Œäº†æ€»ç»“</p><span id="more"></span><h2 id="Widget-ä»‹ç»"><a href="#Widget-ä»‹ç»" class="headerlink" title="Widget ä»‹ç»"></a>Widget ä»‹ç»</h2><p>Widget ä¸æ˜¯ä¸€ä¸ª mini appï¼Œè€Œæ˜¯éœ€è¦åœ¨æŸä¸ªæ—¶é—´ï¼ˆrelevantï¼‰ä¸€ä¸‹å­æä¾›ç›¸å…³çš„é‡è¦ä¿¡æ¯ï¼ˆglanceableï¼‰ã€‚åŒæ—¶èƒ½å¤Ÿè‡ªå®šä¹‰ï¼ˆPersonalizedï¼‰ç‰¹åˆ«æ˜¯éœ€è¦æ”¯æŒå¤šç§å¤§å°ã€‚</p><p>Widget å†…éƒ¨é€šè¿‡ timeline æä¾›ä¸€ç³»åˆ—åœ¨æŸä¸ªæ—¶é—´ç‚¹è¿›è¡Œå±•ç¤ºçš„æ•°æ®ï¼Œå½“ timeline ç»“æŸåï¼Œç³»ç»Ÿä¼šé€‰æ‹©æŸä¸ªæ—¶é—´ç‚¹å¯¹æ‰€æœ‰æ—¶é—´çº¿è¿›è¡Œåˆ·æ–°ã€‚ä¹Ÿå¯ä»¥åœ¨ app ä¸­ä½¿ç”¨ <code>WidgetCenter</code> è¿›è¡Œæ‰‹åŠ¨åˆ·æ–°ã€‚</p><p>Widget å®šä¹‰ä¸Šå¯ä»¥é€‰æ‹©å¯¹å¦‚ä¸‹é€‰é¡¹çš„è¿›è¡Œè‡ªæˆ‘é…ç½®ï¼š</p><ul><li>Kindï¼šstatic configurationï¼›intent configurationï¼ˆå¯ä»¥é•¿æŒ‰ï¼Œé€‰æ‹©å¯¹ widget å…·ä½“å±•ç¤ºå“ªä¸€é¡¹å†…å®¹è¿›è¡Œé…ç½®ï¼‰</li><li>supported familiesï¼šæ”¯æŒå“ªäº›å¤§å°çš„ widgetsï¼Œé»˜è®¤ä¼šæ”¯æŒ3ç§ï¼ˆsmallï¼Œmediumï¼Œlargeï¼‰ã€‚</li></ul><p>Widget çš„å”¯ä¸€äº¤äº’å°±æ˜¯é€šè¿‡æä¾›ä¸€ä¸ª scheme URL ç›´æ¥ç‚¹å‡»å¹¶è¿›å…¥æŸä¸ªæ·±å…¥çš„ app é¡µé¢ã€‚è¿™é‡Œæä¾›äº†ä¸¤ç§ APIï¼Œä¸€ç§æ˜¯ç‚¹å‡»æ•´ä¸ª widget è¿›è¡Œè·³è½¬çš„ <code>.widgetURL</code> ï¼Œå¦ä¸€ç§æ˜¯é’ˆå¯¹å…¶ä¸­æŸä¸ª view è¿›è¡Œè·³è½¬çš„ SwiftUI <code>Link</code> ã€‚</p><p>æ–°å»ºä¸€ä¸ª widget çš„é¡ºåºä¸º File â†’ New â†’ Target â†’ Widget Extensionã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ–°å»º widget çš„æ–‡ä»¶ä¸­ç»“æ„ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Provider</span>: <span class="title class_">IntentTimelineProvider</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">placeholder</span>(<span class="params">in</span> <span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">SimpleEntry</span> &#123;</span><br><span class="line">        <span class="type">SimpleEntry</span>(date: <span class="type">Date</span>(), configuration: <span class="type">ConfigurationIntent</span>())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">getSnapshot</span>(<span class="params">for</span> <span class="params">configuration</span>: <span class="type">ConfigurationIntent</span>, <span class="params">in</span> <span class="params">context</span>: <span class="type">Context</span>, <span class="params">completion</span>: <span class="keyword">@escaping</span> (<span class="type">SimpleEntry</span>) -&gt; ()) &#123;</span><br><span class="line">        <span class="keyword">let</span> entry <span class="operator">=</span> <span class="type">SimpleEntry</span>(date: <span class="type">Date</span>(), configuration: configuration)</span><br><span class="line">        completion(entry)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">getTimeline</span>(<span class="params">for</span> <span class="params">configuration</span>: <span class="type">ConfigurationIntent</span>, <span class="params">in</span> <span class="params">context</span>: <span class="type">Context</span>, <span class="params">completion</span>: <span class="keyword">@escaping</span> (<span class="type">Timeline</span>&lt;<span class="type">Entry</span>&gt;) -&gt; ()) &#123;</span><br><span class="line">        <span class="keyword">var</span> entries: [<span class="type">SimpleEntry</span>] <span class="operator">=</span> []</span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">let</span> timeline <span class="operator">=</span> <span class="type">Timeline</span>(entries: entries, policy: .atEnd)</span><br><span class="line">        completion(timeline)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SimpleEntry</span>: <span class="title class_">TimelineEntry</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> date: <span class="type">Date</span></span><br><span class="line">    <span class="keyword">let</span> configuration: <span class="type">ConfigurationIntent</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TestWidgetEntryView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> entry: <span class="type">Provider</span>.<span class="type">Entry</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(entry.date, style: .time)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@main</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TestWidget</span>: <span class="title class_">Widget</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> kind: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;TestWidget&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">WidgetConfiguration</span> &#123;</span><br><span class="line">        <span class="type">IntentConfiguration</span>(kind: kind, intent: <span class="type">ConfigurationIntent</span>.<span class="keyword">self</span>, provider: <span class="type">Provider</span>()) &#123; entry <span class="keyword">in</span></span><br><span class="line">            <span class="type">TestWidgetEntryView</span>(entry: entry)</span><br><span class="line">        &#125;</span><br><span class="line">        .configurationDisplayName(<span class="string">&quot;My Widget&quot;</span>)</span><br><span class="line">        .description(<span class="string">&quot;This is an example widget.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TestWidget_Previews</span>: <span class="title class_">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">TestWidgetEntryView</span>(entry: <span class="type">SimpleEntry</span>(date: <span class="type">Date</span>(), configuration: <span class="type">ConfigurationIntent</span>()))</span><br><span class="line">            .previewContext(<span class="type">WidgetPreviewContext</span>(family: .systemSmall))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢å°†å¯¹æ¯ä¸€ä¸ªéƒ¨åˆ†è¿›è¡Œè§£é‡Šã€‚</p><p>é¦–å…ˆ Widget æ˜¯é€šè¿‡ SwiftUI æ¡†æ¶è¿›è¡Œç¼–å†™çš„ï¼Œ<code>@main</code> ä¸‹é¢çš„éƒ¨åˆ†éƒ½æ˜¯ä¸€ä¸ª SwiftUI æ–‡ä»¶çš„åŸºç¡€ç»„æˆã€‚<code>@main</code> è¡¨ç¤ºæ•´ä¸ªç¨‹åºçš„å…¥å£ï¼Œ<code>TestWidget</code> å°±æ˜¯æ•´ä¸ª Widget å±•ç¤ºçš„æ ·å¼ï¼Œä¸‹é¢çš„ä¸¤ä¸ª modifier å¯ä»¥ç”¨æ¥æ›´æ”¹ä¸€ä¸ª Widget åœ¨å°ç»„ä»¶åº“ï¼ˆwidget galleryï¼‰ä¸­çš„æè¿°æ–‡å­—ã€‚ä¸‹é¢çš„ preview æ˜¯åœ¨ Xcode ä¸­é¢„è§ˆçš„æ ·å¼ã€‚</p><p>æ•´ä¸ª Widget å°±æ˜¯ä¸€ä¸ª SwiftUI é‡Œé¢çš„ Viewï¼Œä¸Šæ–‡ä¸­ä½“ç°ä¸ºä¸€ä¸ª <code>TestWidgetEntryView</code> ã€‚<code>body</code> ä¸­å°±æ˜¯å…¶å…·ä½“å±•ç¤ºå†…å®¹ã€‚</p><p>WidgetKit é€šè¿‡ widget configuration æœ€åä¸€ä¸ª <code>content</code> çš„ blockï¼Œæ¥æ¸²æŸ“å®é™…çš„ widgetï¼Œè¯¥ block çš„å”¯ä¸€ä¸€ä¸ªå‚æ•°å°±æ˜¯ä¸€ä¸ª <code>Provider.Entry</code> ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢å®šä¹‰çš„ <code>SimpleEntry</code> ï¼Œæ¸²æŸ“ widget view ä¸­å¦ä¸€äº›æ‰€éœ€è¦çš„è‡ªå®šä¹‰æ•°æ®ä¹Ÿæ”¾åœ¨ entry å†…éƒ¨ã€‚</p><p>å¦å¤–ä¸€ä¸ªé‡è¦çš„å°±æ˜¯ <code>TimelineProvider</code> ï¼Œwidget çš„æ›´æ–°æ•°æ®æºæ¥è‡ªäºä¸€ä¸ª timelineã€‚timeline æŒ‡å‡ºäº†åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šçš„æ•°æ®ï¼Œä¸‹é¢å¯¹ <code>TimelineProvider</code> ä¸­çš„ä¸»è¦æ–¹æ³•åšè§£é‡Šã€‚</p><h2 id="TimelineProvider"><a href="#TimelineProvider" class="headerlink" title="TimelineProvider"></a>TimelineProvider</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">placeholder</span>(<span class="params">in</span> <span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">SimpleEntry</span></span><br></pre></td></tr></table></figure><p><code>placeholder</code> å°±æ˜¯ä½œä¸ºä¸€ä¸ªæ•°æ®æ²¡æœ‰åŠ è½½å‡ºæ¥çš„æ—¶å€™çš„ä¸´æ—¶æ ·å¼ã€‚éœ€è¦è¿”å›ä¸€ä¸ªç”¨äºæ¸²æŸ“ view çš„ entryï¼Œä½†æœ€ç»ˆå±•ç¤ºç»“æœå®é™…ä¸Šæ˜¯å°† view ä¸ªéƒ¨åˆ†æ¨¡ç³Šå¤„ç†åçš„ç»“æœï¼ŒåŒæ—¶ï¼Œå› ä¸ºè¿™é‡Œæ˜¯å°† entry ç›´æ¥è¿”å›ï¼Œå¦‚æœ entry ä¸­æœ‰è‡ªå®šä¹‰çš„å±æ€§ï¼Œå¼€å‘è¿‡ç¨‹ä¸­æœ€å¥½ç›´æ¥ä½¿ç”¨ä¸€ä¸ªæœ¬åœ°æ•°æ®ï¼Œè€Œä¸ç”¨å»åŒæ­¥è¿›è¡ŒåŠ è½½ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">getSnapshot</span>(<span class="params">for</span> <span class="params">configuration</span>: <span class="type">ConfigurationIntent</span>, <span class="params">in</span> <span class="params">context</span>: <span class="type">Context</span>, <span class="params">completion</span>: <span class="keyword">@escaping</span> (<span class="type">SimpleEntry</span>) -&gt; ())</span><br></pre></td></tr></table></figure><p>Snapshot æ˜¯æŸä¸€ä¸ª view çš„è§†å›¾ï¼Œä¼šåœ¨ widget gallery ä¸­è¿›è¡Œé¢„è§ˆçš„æ—¶å€™è¢«ä½¿ç”¨ï¼Œå› æ­¤åªæ˜¯ä¸€ä¸ªæ—¶é—´ç‚¹ä¸Šçš„ viewï¼Œ<code>completion</code> åªéœ€è¦ä¼ å…¥ä¸€ä¸ª entryã€‚ç”±äºè¿™ä¸ªåœ°æ–¹ä½¿ç”¨ block å°† entry ä¼ å‡ºï¼Œå› æ­¤è¿™é‡Œå¯ä»¥è¿›è¡Œä¸€äº›å¼‚æ­¥çš„æ“ä½œï¼Œå¦‚ä»æœåŠ¡å™¨è¯·æ±‚æ•°æ®ç­‰ã€‚</p><p><code>Context</code> åŒ…æ‹¬ä¸€äº›ç¯å¢ƒå˜é‡ï¼Œå¦‚ <code>isPreview</code> è¡¨ç¤ºæ˜¯å¦æ˜¯åœ¨é¢„è§ˆï¼Œå¯ä»¥åœ¨ widget gallery è¿›è¡Œé¢„è§ˆæ—¶å•ç‹¬æä¾›ä¸´æ—¶æ•°æ®ï¼›<code>family</code> è¡¨ç¤ºå½“å‰çš„ widget å¤§å°ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">getTimeline</span>(<span class="params">for</span> <span class="params">configuration</span>: <span class="type">ConfigurationIntent</span>, <span class="params">in</span> <span class="params">context</span>: <span class="type">Context</span>, <span class="params">completion</span>: <span class="keyword">@escaping</span> (<span class="type">Timeline</span>&lt;<span class="type">Entry</span>&gt;) -&gt; ())</span><br></pre></td></tr></table></figure><p>Widget çš„ time-line æä¾›äº†æœªæ¥å¤šä¸ªæ—¶é—´ç‚¹ä¸Š widget éœ€è¦çš„æ•°æ®æºï¼Œè¿™é‡Œå¯ä»¥çœ‹ä¸€ä¸‹ block ä¸­ <code>Timeline&lt;Entry&gt;</code> çš„å®šä¹‰ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> <span class="title class_">Timeline</span>&lt;<span class="title class_">EntryType</span>&gt; <span class="title class_">where</span> <span class="title class_">EntryType</span> : <span class="title class_">TimelineEntry</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> entries: [<span class="type">EntryType</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> policy: <span class="type">TimelineReloadPolicy</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° Timeline ä¸­åŒ…æ‹¬äº†ä¸€æ•´ä¸ªæ•°ç»„çš„ entryï¼Œä¹‹å‰å¯ä»¥çœ‹åˆ°æ¯ä¸ª entry ä¸­åŒ…æ‹¬äº†ä¸€ä¸ª date å±æ€§ï¼Œè¡¨ç¤ºåœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´ç‚¹ä¸Šä¼šè¢«ä½¿ç”¨ã€‚æ¯ä¸ª app çš„æ•´æ¡æ—¶é—´çº¿ä¸Šçš„ widget ä¼šè¢«åºåˆ—åŒ–æ”¾å…¥ç£ç›˜ä¸­ï¼ˆå¾ˆå¤šæ—¶å€™åŒ…æ‹¬å‡ å¤©ï¼‰ï¼Œè¿™ä½¿å¾—ç³»ç»Ÿèƒ½å¤ŸåŒæ—¶è¿è¡Œå¤šä¸ª app widget çš„æ—¶é—´çº¿ã€‚</p><p>æ¯”å¦‚è¯´æˆ‘ä»¬å¸Œæœ› widget å±•ç¤ºä¸€ä¸ªç­‰çº§ï¼Œç„¶åæ¯ä¸€ä¸ªå°æ—¶ç­‰çº§åŠ ä¸Š1ï¼Œåœ¨ entry ä¸­åŠ å…¥ <code>level</code> å±æ€§åï¼Œå¯ä»¥ç”Ÿæˆè¿™æ ·çš„æ—¶é—´çº¿ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> entries: [<span class="type">SimpleEntry</span>] <span class="operator">=</span> []</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> currentDate <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line"><span class="keyword">var</span> currentLevel <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line"><span class="keyword">for</span> hourOffset <span class="keyword">in</span> <span class="number">0</span> <span class="operator">..&lt;</span> <span class="number">5</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> entryDate <span class="operator">=</span> <span class="type">Calendar</span>.current.date(byAdding: .hour, value: hourOffset, to: currentDate)<span class="operator">!</span></span><br><span class="line">  <span class="keyword">let</span> entry <span class="operator">=</span> <span class="type">SimpleEntry</span>(date: entryDate, configuration: configuration, level: currentLevel)</span><br><span class="line">  currentLevel <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">  entries.append(entry)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> timeline <span class="operator">=</span> <span class="type">Timeline</span>(entries: entries, policy: .atEnd)</span><br><span class="line">completion(timeline)</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œä¹Ÿå­˜åœ¨å¾ˆå¤šéœ€è¦ widget åªéœ€è¦å³æ—¶çš„æ•°æ®ï¼Œæ­¤æ—¶æä¾›å½“å‰èƒ½å¤Ÿæ‹¿åˆ°çš„ entry å°±å¯ä»¥ï¼Œå³ä½¿åªæœ‰ä¸€ä¸ªã€‚åç»­æˆ‘ä»¬å°†å¯¹ widget å¦‚ä½•è¿›è¡Œåˆ·æ–°è¿›è¡Œè¿›ä¸€æ­¥ä»‹ç»ã€‚</p><p>timeline çš„å¦ä¸€ä¸ªå‚æ•°æ˜¯ <code>policy</code> ï¼Œä»£è¡¨äº†ç³»ç»Ÿåˆ·æ–° widget çš„æ—¶æœºã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> <span class="title class_">TimelineReloadPolicy</span> : <span class="title class_">Equatable</span> &#123;</span><br><span class="line"><span class="comment">/// åœ¨ timeline ä¸­çš„æ‰€æœ‰ entry éƒ½è¢«ä½¿ç”¨å®Œåçš„æŸä¸ªæ—¶é—´ç‚¹åˆ·æ–°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> atEnd: <span class="type">TimelineReloadPolicy</span></span><br><span class="line"><span class="comment">/// æ°¸è¿œä¸è¿›è¡Œè¢«åŠ¨åˆ·æ–°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> never: <span class="type">TimelineReloadPolicy</span></span><br><span class="line"><span class="comment">/// åœ¨æŸä¸ªæ—¶é—´ç‚¹ååˆ·æ–°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">after</span>(<span class="keyword">_</span> <span class="params">date</span>: <span class="type">Date</span>) -&gt; <span class="type">TimelineReloadPolicy</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªæ—¶é—´ç‚¹ä»…ä»…è¡¨ç¤ºä¸€ç§å»ºè®®çš„æœ€æ—©æ—¶é—´ç‚¹ï¼Œå®é™…è¿‡ç¨‹ä¸­ç³»ç»Ÿè¿˜ä¼šè€ƒè™‘è¯¸å¦‚ app æ´»è·ƒåº¦ï¼Œæœ€è¿‘åˆ·æ–°æ—¶é—´ç­‰å› ç´ ï¼Œè€Œä¸”æ¯ä¸ª widget åœ¨ä¸€å¤©ä¸­éƒ½æœ‰ä¸€å®šçš„åˆ·æ–°æ¬¡æ•°é™åˆ¶ã€‚</p><p>å¦ä¸€ç§ä¸»åŠ¨æ–¹æ³•æ˜¯åœ¨ app å†…éƒ¨é€šè¿‡ <code>WidgetCenter</code> ä»Šå¤©åˆ·æ–°ï¼Œ<code>WidgetCenter</code> :</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">WidgetCenter</span>.shared.reloadAllTimelines() <span class="comment">// å¯¹ app ä¸­æ‰€æœ‰çš„ widget éƒ½ç”Ÿæˆä¸€æ¡æ–°çš„æ—¶é—´çº¿</span></span><br><span class="line"><span class="type">WidgetCenter</span>.shared.reloadTimelines(ofKind: <span class="string">&quot;TestWidget&quot;</span>) <span class="comment">// å¯¹ app ä¸­æŸä¸ªç‰¹å®šçš„ widget åˆ·æ–°æ•´æ¡æ—¶é—´çº¿ï¼Œkind å¯¹åº”çš„äº‹ widget view ä¸­çš„ kind å±æ€§</span></span><br></pre></td></tr></table></figure><h2 id="å¼€å‘ä¸­çš„å…¶ä»–é—®é¢˜"><a href="#å¼€å‘ä¸­çš„å…¶ä»–é—®é¢˜" class="headerlink" title="å¼€å‘ä¸­çš„å…¶ä»–é—®é¢˜"></a>å¼€å‘ä¸­çš„å…¶ä»–é—®é¢˜</h2><h3 id="å¤šä¸ª-widget-å¤§å°ä½¿ç”¨ä¸åŒçš„-view"><a href="#å¤šä¸ª-widget-å¤§å°ä½¿ç”¨ä¸åŒçš„-view" class="headerlink" title="å¤šä¸ª widget å¤§å°ä½¿ç”¨ä¸åŒçš„ view"></a>å¤šä¸ª widget å¤§å°ä½¿ç”¨ä¸åŒçš„ view</h3><p>å¦‚æœåªæ˜¯éœ€è¦åœ¨ä¸åŒå¤§å°çš„ widget ä¸‹ä½¿ç”¨ä¸åŒçš„ viewï¼Œåªéœ€è¦åœ¨é‚£ä¸ª widget çš„ view ä¸­é€šè¿‡ç¯å¢ƒç¯å¢ƒå˜é‡å–å¾—ç°åœ¨çš„ widget familyï¼Œç„¶åæ ¹æ®ä¸åŒçš„ family è¿”å›ä¸åŒçš„ viewã€‚</p><p><code>@Environment</code> å°±æ˜¯å»å–å¾—ç¯å¢ƒå˜é‡ <code>EnvironmentValues</code> ä¸­çš„å¯¹åº”åç§°ï¼ˆkey pathï¼‰çš„å±æ€§å€¼ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Environment</span>(\.widgetFamily) <span class="keyword">var</span> family</span><br><span class="line"></span><br><span class="line"><span class="meta">@ViewBuilder</span></span><br><span class="line"><span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line"><span class="keyword">switch</span> family &#123;</span><br><span class="line"><span class="keyword">case</span> .systemSmall:</span><br><span class="line"><span class="type">WidgetSmallView</span>()</span><br><span class="line"><span class="keyword">case</span> .systemMedium:</span><br><span class="line"><span class="type">WidgetMediumView</span>()</span><br><span class="line"><span class="keyword">case</span> .systemLarge:</span><br><span class="line"><span class="type">WidgetLargeView</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿”å›å€¼ <code>some View</code> æŒ‡æŸç‰¹å®šä¸€ç§å®ç°äº† <code>View</code> åè®®çš„ç±»ï¼Œå› ä¸ºè¿™é‡Œéœ€è¦è¿”å›é›†ä¸­ä¸åŒçš„ View ç±»ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ <code>ViewBuilder</code> å°†ä»–ä»¬åŒ…è£…æˆä¸€ä¸ª <code>TupleView</code> ä¿è¯è¿”å›å€¼åœ¨å„ä¸ªæ¡ä»¶åˆ†æ”¯ä¸‹éƒ½ç›¸åŒã€‚æƒ³è¿›ä¸€æ­¥äº†è§£å¯ä»¥æŸ¥çœ‹ SwiftUI ç›¸å…³æ•™ç¨‹ã€‚</p></blockquote><p>å¦ä¸€ç§æƒ…å†µæ˜¯å¯¹äºåŒä¸€ä¸ªå¤§å°çš„ä¹Ÿå¸Œæœ›æä¾›å¤šç§ä¸åŒçš„ Widgetã€‚æ­¤æ—¶éœ€è¦åœ¨ widget æ–‡ä»¶ä¸­æ–°å»ºä¸€ä¸ª <code>WidgetBundle</code> ç±»å¹¶å°†ç›¸å…³çš„æ‰€æœ‰ Widget çš„ view æ”¾åœ¨é‡Œé¢ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦å°†ä»£è¡¨å…¥å£çš„ <code>@main</code> ç§»åˆ°è¿™ä¸ª bundle ä¸Šé¢ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@main</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MyWidgetBundle</span> : <span class="title class_">WidgetBundle</span> &#123;</span><br><span class="line">    <span class="meta">@WidgetBundleBuilder</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">Widget</span> &#123;</span><br><span class="line">        <span class="type">FirstWidget</span>()</span><br><span class="line"> <span class="type">SecondWidget</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å’Œä¸»-App-çš„æ•°æ®äº¤äº’"><a href="#å’Œä¸»-App-çš„æ•°æ®äº¤äº’" class="headerlink" title="å’Œä¸» App çš„æ•°æ®äº¤äº’"></a>å’Œä¸» App çš„æ•°æ®äº¤äº’</h3><p>é¦–å…ˆéƒ½è¿›è¡Œè®¾ç½®ï¼Œä¿è¯ app å’Œ widget extension å¯¹åº”çš„ app group æ˜¯åŒä¸€ä¸ªã€‚é€šè®¯å¯ä»¥ä½¿ç”¨ <code>UserDefaults</code> , <code>FileManager</code> æˆ–è€… CoreData çš„æ–¹æ³•è¿›è¡ŒåŒæ­¥ï¼Œä¸‰è€…å…¶å®éƒ½æ˜¯æŒä¹…åŒ–æ•°æ®çš„æ–¹æ³•ã€‚ä¸‹é¢ä¸»è¦å¯¹ <code>UserDefault</code> æ–¹æ³•è¿›è¡Œè¯´æ˜ï¼š</p><p>ç”±äº extension å’Œä¸» app ä½¿ç”¨çš„ä¸æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå› æ­¤åªèƒ½å°†æ•°æ®å­˜æ”¾åœ¨åŒä¸€ä¸ª app group ä¸­ï¼Œè€Œä¸èƒ½ç›´æ¥æ”¾åœ¨ <code>UserDefaults.standard</code> ä¸­ã€‚<a href="https://stackoverflow.com/questions/45607903/sharing-userdefaults-between-extensions">Share UserDefaults between extensions</a></p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç±»ä¼¼äºæ’­æ”¾å™¨çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸» app åœ¨ç‚¹å‡»æ’­æ”¾æ—¶ï¼Œwidget ä¸Šçš„ view å›¾æ ‡ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> userDefault <span class="operator">=</span> <span class="type">UserDefaults</span>(suiteName: <span class="string">&quot;group.com.lsy.testWidget&quot;</span>)<span class="operator">!</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> isPlaying <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Button</span> &#123;</span><br><span class="line">            isPlaying.toggle()</span><br><span class="line">            userDefault.set(isPlaying, forKey: <span class="string">&quot;isPlaying&quot;</span>)</span><br><span class="line">            <span class="type">WidgetCenter</span>.shared.reloadAllTimelines()</span><br><span class="line">        &#125; label: &#123;</span><br><span class="line">            <span class="type">Image</span>(systemName: isPlaying <span class="operator">?</span> <span class="string">&quot;pause.circle&quot;</span> : <span class="string">&quot;play.circle&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸» app ä¸­çš„ä»£ç å®é™…ä¸Šå°±æ˜¯æ›´æ”¹äº† isPlaying çš„çŠ¶æ€å¹¶å¯¹ widget è¿›è¡Œäº†åˆ·æ–°ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">getTimeline</span>(<span class="params">for</span> <span class="params">configuration</span>: <span class="type">ConfigurationIntent</span>, <span class="params">in</span> <span class="params">context</span>: <span class="type">Context</span>, <span class="params">completion</span>: <span class="keyword">@escaping</span> (<span class="type">Timeline</span>&lt;<span class="type">Entry</span>&gt;) -&gt; ()) &#123;</span><br><span class="line">    <span class="keyword">let</span> isPlaying <span class="operator">=</span> <span class="type">UserDefaults</span>(suiteName: <span class="string">&quot;group.com.lsy.testWidget&quot;</span>)<span class="operator">!</span>.bool(forKey: <span class="string">&quot;isPlaying&quot;</span>)</span><br><span class="line">    <span class="keyword">let</span> entries: [<span class="type">SimpleEntry</span>] <span class="operator">=</span> [<span class="type">SimpleEntry</span>(date: <span class="type">Date</span>(), configuration: configuration, isPlaying: isPlaying)]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> timeline <span class="operator">=</span> <span class="type">Timeline</span>(entries: entries, policy: .atEnd)</span><br><span class="line">    completion(timeline)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TestWidgetEntryView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> entry: <span class="type">Provider</span>.<span class="type">Entry</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">Image</span>(systemName: entry.isPlaying <span class="operator">?</span> <span class="string">&quot;pause.circle&quot;</span> : <span class="string">&quot;play.circle&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Widget åœ¨ timeline ä¸­è¯»å–äº†å€¼ï¼Œå¹¶æ ¹æ®æ˜¯å¦åœ¨æ’­æ”¾å†³å®šå±•ç¤ºçš„å›¾æ ‡ã€‚</p><p>ä¹Ÿå¯ä»¥é€šè¿‡ <a href="craftdocs://open?blockId=ACCB5181-F6BC-41AA-9D81-1E0EA8C27D13&spaceId=ea081854-0d6c-dace-b07b-5007ad758cc9"><code>AppStorage ç›´æ¥åœ¨ view ä¸­è¿›è¡Œè¯»å–ã€‚</code></a></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">TestWidgetEntryView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> entry: <span class="type">Provider</span>.<span class="type">Entry</span></span><br><span class="line">    <span class="meta">@AppStorage</span>(<span class="string">&quot;isPlaying&quot;</span>, store: <span class="type">UserDefaults</span>(suiteName: <span class="string">&quot;group.com.lsy.testWidget&quot;</span>)) <span class="keyword">var</span> isPlaying: <span class="type">Bool</span> <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">Image</span>(systemName: isPlaying <span class="operator">?</span> <span class="string">&quot;pause.circle&quot;</span> : <span class="string">&quot;play.circle&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äº widget æ˜¯ä¸€ä¸ªé™æ€çš„ viewï¼Œ<code>@AppStorage</code> å€¼çš„å˜åŒ–ä¸ä¼šå“åº”å‡ºæ¥ï¼Œè¿˜æ˜¯åªèƒ½é€šè¿‡ä¸» app æ‰‹åŠ¨è°ƒç”¨ reloadã€‚</p><h3 id="å¼‚æ­¥çš„å›¾ç‰‡åŠ è½½"><a href="#å¼‚æ­¥çš„å›¾ç‰‡åŠ è½½" class="headerlink" title="å¼‚æ­¥çš„å›¾ç‰‡åŠ è½½"></a>å¼‚æ­¥çš„å›¾ç‰‡åŠ è½½</h3><p>å¯¹äº widget ä¸Šçš„å›¾ç‰‡ï¼Œè¦æ³¨æ„çš„æ˜¯ widget æ˜¯ä¸€ä¸ªé™æ€ viewï¼Œé€šè¿‡ timeline ä¸­æä¾›çš„ entry è¿›è¡Œæ¸²æŸ“å¹¶å±•ç¤ºåä¸ä¼šå†é»˜è®¤è¿›è¡Œåå°ä»»åŠ¡ï¼Œå› æ­¤ï¼Œå¦‚æœæœ‰ä¸€ä¸ªå›¾ç‰‡è¦é€šè¿‡ URL è¿›è¡Œè·å–ï¼Œéœ€è¦åœ¨æä¾›çš„ entry å‰å°±åŠ è½½å®Œæˆã€‚</p><p>iOS ä¸­å¯ä»¥ä½¿ç”¨ <code>DispatchGroup</code> æ¥ä¿è¯æ‰€æœ‰å›¾ç‰‡è¢«åŠ è½½å®Œæˆï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ImageFromURL</span> &#123;</span><br><span class="line"><span class="keyword">let</span> urlString: <span class="type">URL</span></span><br><span class="line"><span class="keyword">var</span> image: <span class="type">UIImage</span>?</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Array</span> <span class="title class_">where</span> <span class="title class_">Element</span> == <span class="title class_">ImageFromURL</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">fetchAllImages</span>(<span class="params">completion</span>:<span class="keyword">@escaping</span> ([<span class="type">ImageFromURL</span>]) -&gt;()) &#123;</span><br><span class="line">        <span class="keyword">let</span> dispatchGroup <span class="operator">=</span> <span class="type">DispatchGroup</span>()</span><br><span class="line">        <span class="keyword">var</span> images: [<span class="type">ImageFromURL</span>] <span class="operator">=</span> []</span><br><span class="line">        <span class="keyword">self</span>.forEach &#123; element <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: element.urlString) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            dispatchGroup.enter()</span><br><span class="line">            <span class="type">URLSession</span>.shared.dataTask(with: url) &#123; data, response, error <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">let</span> data <span class="operator">=</span> data, <span class="keyword">let</span> image <span class="operator">=</span> <span class="type">UIImage</span>(data: data) &#123;</span><br><span class="line">                    <span class="keyword">var</span> element <span class="operator">=</span> element</span><br><span class="line">                    element.image <span class="operator">=</span> image</span><br><span class="line">                    images.append(element)</span><br><span class="line">                &#125;</span><br><span class="line">                dispatchGroup.leave()</span><br><span class="line">            &#125;.resume()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        dispatchGroup.notify(queue: .main) &#123;</span><br><span class="line">            completion(images)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦ä¸€ä¸ªæ–¹æ³•æ˜¯è®©æœåŠ¡ç«¯ç¬¬ä¸€æ¬¡å°±ç›´æ¥ä¸‹å‘å›¾ç‰‡çš„ base64 dataã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;åœ¨å¼€å‘ iOS widget çš„è¿‡ç¨‹ä¸­å¯¹ widget çš„ä½¿ç”¨èŒƒå›´å’ŒåŸºæœ¬ç»“æ„æœ‰äº†åŸºæœ¬äº†è§£ï¼ŒåŒæ—¶åœ¨å¼€å‘ä¸­ä¹Ÿé‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œæœ¬æ–‡å¯¹ä»¥ä¸Šå†…å®¹è¿›è¡Œäº†æ€»ç»“&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>ğŸŒ AFNetworking æºç åˆ†æ</title>
    <link href="http://example.com/2022/05/29/%F0%9F%8C%90%20AFNetworking%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    <id>http://example.com/2022/05/29/%F0%9F%8C%90%20AFNetworking%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</id>
    <published>2022-05-29T13:07:00.000Z</published>
    <updated>2022-05-29T13:09:04.468Z</updated>
    
    <content type="html"><![CDATA[<p>ç ”ç©¶äº† AFNetworking ç½‘ç»œæ¡†æ¶çš„ä¸»è¦ç»“æ„å’Œæ–¹æ³•ï¼Œå¯¹å…¶å†…éƒ¨å¦‚ä½•å»ºç«‹ä¸€ä¸ªè¯·æ±‚ï¼Œåšäº†å“ªäº›é¢å¤–å·¥ä½œï¼Œç‰¹åˆ«æ˜¯å¦‚ä½•å‘é€ä¸€ä¸ª multipart request è¯·æ±‚è¿›è¡Œäº†è¾ƒä¸ºæ·±å…¥çš„åˆ†æã€‚</p><span id="more"></span><p>AFNetworking ä½œä¸º iOS æœ€è‘—åçš„ç½‘ç»œæ¡†æ¶ä¹‹ä¸€ï¼Œå¯¹å®˜æ–¹ <code>NSURLSession</code> ä¸€ç³»åˆ— API è¿›è¡Œäº†å°è£…ï¼Œæä¾›äº†å¤§é‡æ›´æ–¹ä¾¿ä½¿ç”¨çš„æ¥å£ã€‚</p><p>å¯¹äºè¿™æ ·ä¸€ç§æ¡†æ¶ï¼Œæˆ‘è®¤ä¸ºæƒ³è¦äº†è§£å…¶ç›¸å¯¹äºåŸç”Ÿ API çš„ä¼˜åŠ¿ï¼Œé¦–å…ˆå°±éœ€è¦å¯¹ä¸¤è€… API çš„ä½¿ç”¨æœ‰ä¸€å®šçš„äº†è§£ï¼Œåœ¨é˜…è¯»å…¶æºç å‰ï¼Œæˆ‘å†™äº†ä¸€ä¸ª Demoã€‚Demo ä½¿ç”¨çš„ç½‘ç»œè¯·æ±‚ç±»ä¸­åŒæ—¶æä¾›æ¥å£ç›¸åŒçš„ã€ä½†å†…éƒ¨åˆ†åˆ«ç”±åŸç”Ÿ API å’Œ AFNetworking API å®ç°ï¼Œä»¥æ­¤æ¥æ„Ÿå—åŒæ–¹ API çš„å·®å¼‚æ€§ã€‚è¯¦æƒ…å¯ä»¥å‚è€ƒ <a href="https://github.com/jjakj1/AFNetworkingDemo">Github</a> ä¸­çš„ <code>NetworkingDataManager</code> ç±»ã€‚ï¼ˆå…¶å®æœ€å¼€å§‹è¿›è¡Œå¯¹æ¯”çš„æ—¶å€™ï¼Œæˆ‘æ²¡æœ‰ç‰¹åˆ«æ„Ÿå—åˆ° AFNetworking ç›¸å¯¹äºåŸç”Ÿ API æ–¹ä¾¿å¾ˆå¤šï¼Œå¯èƒ½æ›´å¤šç»†èŠ‚åœ¨äºå¯¹äºé”™è¯¯æƒ…å†µçš„å¤„ç†å’Œæ•°æ®çš„è½¬æ¢ä¸Šï¼Œè¿™ä¸ªéœ€è¦ç­‰é˜…è¯»æºç åæ‰èƒ½å¾—å‡ºç»“è®ºï¼‰</p><h2 id="AFURLSessionManager"><a href="#AFURLSessionManager" class="headerlink" title="AFURLSessionManager"></a>AFURLSessionManager</h2><p><code>AFURLSessionManger</code> ä½œä¸ºè°ƒç”¨ AFNetworking æ‰€æä¾›çš„ API çš„ç±»ï¼Œå¤§è‡´ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="https://res.craft.do/user/full/ea081854-0d6c-dace-b07b-5007ad758cc9/doc/BAA570CA-8DD7-4D68-9E22-C44B50358FF0/BE908F8C-99D6-49B7-A074-E0B057FB241D_2/VaA0yRAbWDxG6ohe6papFFzxtYxxrh4ZyFVBBg71ynQz/AFURLSessionManager.png" alt="AFURLSessionManager.png"></p><p>å…¶ä¸­ <code>AFURLSessionManager</code> è‡ªèº«å®ç°äº†å‡ ä¸ªå®˜æ–¹çš„ Delegateï¼Œå¹¶æä¾›äº†ä¸€ç³»åˆ—çš„ block ä½œä¸ºå±æ€§ï¼Œè®©å¤–ç•Œå»è®¾ç½®ã€‚å†…éƒ¨ç§æœ‰äº†ä¸€ä¸ª <code>AFURLSessionManagerTaskDelegate</code> ç±»ï¼Œå…¶å®ç°äº†é™¤ <code>NSURLSessionDelegate</code> ä¹‹å¤–å…¶ä»–ä¸‰ä¸ª Delegate çš„å¤§éƒ¨åˆ†æ–¹æ³•ã€‚</p><p><code>AFURLSessionManager</code> å†…éƒ¨æœ€é‡è¦çš„ç»“æ„æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå…¶ä½¿ç”¨åˆ›å»ºçš„å„ä¸ª <code>URLSessionTask</code> çš„ identifier ä½œä¸ºé”®ï¼Œå¹¶å°†ä¸€ä¸ª <code>AFURLSessionManagerTaskDelegate</code> å¯¹è±¡ä½œä¸ºå€¼ï¼Œè¯¥å¯¹è±¡ä¼šåœ¨æ¯æ¬¡åˆ›å»ºä¸€ä¸ªæ–°çš„ task æ—¶è¢«åŒæ—¶åˆ›å»ºï¼Œå¹¶å°†ä¸€äº›ä¸ºäº†å®ç°ä¸‰ç§ä»£ç†ä¸­æ–¹æ³•æ‰€éœ€è¦çš„ block ä¼ å…¥è¿›å»ã€‚Delegate æœ€ç»ˆä¼šåœ¨ <code>URLSession:task:didCompleteWithError:</code> ä¸­è¢«é‡Šæ”¾</p><p><code>AFURLSessionManager</code> å¤„ç†ä¸€ä¸ªä»£ç†æ–¹æ³•æœ€æ™®éçš„è¡Œä¸ºå®é™…ä¸Šåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</p><ul><li><code>AFURLSessionManagerTaskDelegate</code> å¦‚æœä¹Ÿå®ç°äº†é‚£ä¸ªä»£ç†æ–¹æ³•ï¼Œå°±ä¼šä»å­—å…¸é‡Œæ‰¾åˆ°å½“å‰ task å¯¹åº”çš„ Delegate å¹¶è°ƒç”¨ Delegate é‡Œé¢çš„å¯¹åº”ä»£ç†æ–¹æ³•ã€‚</li><li>å¦‚æœ <code>AFURLSessionManagerTaskDelegate</code> æ²¡æœ‰å®ç°è¯¥æ–¹æ³•ï¼Œå°±åˆ¤æ–­å¯¹åº”çš„ block æ˜¯å¦è¢«è®¾ç½®ï¼Œå¦‚æœè¿›è¡Œäº†è®¾ç½®ï¼Œåˆ™è°ƒç”¨è¯¥ blockã€‚</li></ul><p>å¦å¤–å†…éƒ¨è¿˜ä¿å­˜å¹¶é»˜è®¤è®¾ç½®äº†ä»¥ä¸‹å±æ€§æ¥å¯¹å†…éƒ¨çš„çŠ¶æ€å’Œæ•°æ®è¿›è¡Œå¤„ç†ï¼Œåç»­ä¹Ÿä¼šè¿›è¡Œåˆ†æã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="type">id</span> &lt;AFURLResponseSerialization&gt; responseSerializer; <span class="comment">// default is AFJSONResponseSerializer</span></span><br></pre></td></tr></table></figure><h2 id="AFHTTPSessionManager"><a href="#AFHTTPSessionManager" class="headerlink" title="AFHTTPSessionManager"></a>AFHTTPSessionManager</h2><p>ç»§æ‰¿äº† <code>AFURLSessionManager</code> ï¼Œå†…éƒ¨åŸºæœ¬ä¸€è‡´ï¼Œæ·»åŠ äº† <code>AFHTTPRequestSerializer</code> å±æ€§ã€‚å¹¶é»˜è®¤æä¾›äº†ä¸€ä¸ª <code>AFHTTPRequestSerializer</code> ä½œä¸ºå…¶é»˜è®¤å€¼ã€‚åŒæ—¶å¯¹äº <code>requestSerializer</code> å±æ€§çš„å®šä¹‰ä¹Ÿæœ‰æ‰€å˜åŒ–ï¼Œä½†é»˜è®¤èµ‹å€¼è¿˜æ˜¯ <code>AFJSONResponseSerializer</code> ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// In AFURLSessionManager</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="type">id</span> &lt;AFURLResponseSerialization&gt; responseSerializer;</span><br><span class="line"><span class="comment">// In AFHTTPSessionManager</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) AFHTTPResponseSerializer &lt;AFURLResponseSerialization&gt; * responseSerializer</span><br></pre></td></tr></table></figure><p>æ·»åŠ äº†ä¸€ä¸ª <code>baseURL</code> å±æ€§ï¼Œæ–¹ä¾¿åœ¨ä¹‹åçš„è¯·æ±‚ä¸­ï¼Œåªç”¨æä¾›å‰©ä¸‹çš„æ–‡ä»¶è·¯å¾„ã€‚</p><p>ä¸»è¦æä¾›äº†ä¸€äº›å¸¦æœ‰ HTTP method ï¼ˆGETã€POST ç­‰ï¼‰çš„ data task ç›¸å…³æ–¹æ³•ï¼Œå…¶å†…éƒ¨å®ç°åŸºæœ¬éƒ½æ˜¯ç›´æ¥è°ƒç”¨äº†ä¸‹é¢çš„è¿™ä¸ªç§æœ‰æ–¹æ³•ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSURLSessionDataTask</span> *)dataTaskWithHTTPMethod:(<span class="built_in">NSString</span> *)method</span><br><span class="line">                                       URLString:(<span class="built_in">NSString</span> *)URLString</span><br><span class="line">                                      parameters:(<span class="keyword">nullable</span> <span class="type">id</span>)parameters</span><br><span class="line">                                         headers:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span> &lt;<span class="built_in">NSString</span> *, <span class="built_in">NSString</span> *&gt; *)headers</span><br><span class="line">                                  uploadProgress:(<span class="keyword">nullable</span> <span class="type">void</span> (^)(<span class="built_in">NSProgress</span> *uploadProgress)) uploadProgress</span><br><span class="line">                                downloadProgress:(<span class="keyword">nullable</span> <span class="type">void</span> (^)(<span class="built_in">NSProgress</span> *downloadProgress)) downloadProgress</span><br><span class="line">                                         success:(<span class="keyword">nullable</span> <span class="type">void</span> (^)(<span class="built_in">NSURLSessionDataTask</span> *task, <span class="type">id</span> _Nullable responseObject))success</span><br><span class="line">                                         failure:(<span class="keyword">nullable</span> <span class="type">void</span> (^)(<span class="built_in">NSURLSessionDataTask</span> * _Nullable task, <span class="built_in">NSError</span> *error))failure;</span><br></pre></td></tr></table></figure><p>è¯¥æ–¹æ³•ä¸­åˆ©ç”¨ <code>AFHTTPRequestSerializer</code> æ¥å°† <code>method</code> <code>URLString</code> å’Œ <code>paramters</code> åˆå¹¶æˆä¸€ä¸ª <code>NSMutableURLRequest</code> å¹¶éå†æ‰€æœ‰çš„ <code>headers</code> ä¸­çš„é”®å€¼å¯¹ã€‚æ¥ä½¿ç”¨ <code>setValue: forHTTPHeaderField:</code> æ–¹æ³•æ›´æ”¹ Header ä¸­çš„å€¼ï¼Œæœ€åè°ƒç”¨çˆ¶ç±»ä¸­åˆ›å»º data task çš„æ–¹æ³•ã€‚</p><h2 id="AFHTTPRequestSerializer"><a href="#AFHTTPRequestSerializer" class="headerlink" title="AFHTTPRequestSerializer"></a>AFHTTPRequestSerializer</h2><p><code>AFHTTPRequestSerializer</code> å®ç°äº†åè®® <code>AFURLRequestSerialization</code> ã€‚è¯¥åè®®æä¾›äº†ä»¥ä¸‹çš„æ–¹æ³•ï¼Œè€Œ <code>AFHTTPRequestSerializer</code> ä¹Ÿå°±æ˜¯é€šè¿‡è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ¥å°†ä¸€ä¸ª request å’Œ parameters è¿›è¡Œåºåˆ—åŒ–ï¼Œä»è€Œç”Ÿæˆä¸€ä¸ªæ–°çš„ requestï¼Œè¿™ä¸ªæ–¹æ³•çš„è¯¦ç»†å®ç°å°†åœ¨åç»­è®²è¿°ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">NSURLRequest</span> *)requestBySerializingRequest:(<span class="built_in">NSURLRequest</span> *)request</span><br><span class="line">                                        withParameters:(<span class="keyword">nullable</span> <span class="type">id</span>)parameters</span><br><span class="line">                                                 error:(<span class="built_in">NSError</span> * _Nullable __autoreleasing *)error <span class="built_in">NS_SWIFT_NOTHROW</span>;</span><br></pre></td></tr></table></figure><p><code>AFHTTPRequestSerializer</code> çš„åˆå§‹åŒ–è¿‡ç¨‹ä¸»è¦å¹²äº† 3 ä»¶äº‹ï¼š</p><ol><li>é€šè¿‡ <code>[NSLocale preferredLanguages]</code> ä»è®¾ç½®ä»å–å‡ºæœ¬æœºåå¥½çš„è¯­è¨€é¡ºåºï¼Œå¹¶ä½¿ç”¨æ­¤ä¿¡æ¯è®¾ç½® HTTP header ä¸­çš„ <strong>Accept-Language</strong> ã€‚</li><li>é€šè¿‡ bundle æˆ– device çš„ä¿¡æ¯è®¾ç½® HTTP header ä¸­çš„ <strong>User-Agent</strong> ã€‚</li><li>ä½¿ç”¨ KVO å°†è‡ªèº«ä½œä¸ºç›‘å¬è€…ï¼Œç›‘å¬å†…éƒ¨ä¸€äº›å…¶ä»–å±æ€§çš„å˜åŠ¨ã€‚å¦‚ <code>allowsCellularAccess</code> <code>HTTPShouldHandleCookies</code> ç­‰ï¼Œè¿™äº›ä¹Ÿéƒ½æ˜¯ <code>NSURLRequest</code> çš„ä¸€äº›å±æ€§ã€‚å±æ€§ä¼šåœ¨å˜åŠ¨æ—¶ï¼Œè¢«åŠ å…¥å†…éƒ¨çš„ <code>mutableObservedChangedKeyPaths</code> å±æ€§ä¸­ï¼Œè¯¥å±æ€§æ˜¯ä¸€ä¸ª <code>NSMutableSet</code> ã€‚</li></ol><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¯¥ç±»è¿˜æä¾›äº†ä¸€äº›ç”¨äºè®¾ç½® HTTP header çš„æ–¹æ³•ï¼Œå¦‚ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)setValue:(<span class="built_in">NSString</span> *)value</span><br><span class="line">forHTTPHeaderField:(<span class="built_in">NSString</span> *)field;</span><br></pre></td></tr></table></figure><p>è¢«è®¾ç½® value å’Œ field éƒ½ä¼šä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜æ”¾åœ¨å†…éƒ¨çš„ä¸€ä¸ª <code>NSMutableDictionary</code> ä¸­ï¼Œç›´åˆ°æœ€åè°ƒç”¨ä¸Šé¢çš„åºåˆ—åŒ–æ–¹æ³•æ—¶æ‰ä¼šè¢«é›†ä½“ä½¿ç”¨ï¼Œé€šè¿‡è°ƒç”¨ <code>setValue:forHTTPHeaderField:</code> æ–¹æ³•è®¾ç½®æœ€ç»ˆ request çš„ HTTP header Fieldã€‚</p><p>ä¸€ä¸ªç»†èŠ‚æ˜¯ï¼Œä¸ºäº†ä¿è¯åœ¨ set header æ—¶çš„çº¿ç¨‹å®‰å…¨ï¼Œåœ¨è®¾ç½®æ—¶å†…éƒ¨ä½¿ç”¨äº† <code>dispatch_barrier_sync</code> ã€‚</p><h3 id="é-multipart-request"><a href="#é-multipart-request" class="headerlink" title="é multipart request"></a>é multipart request</h3><p><code>AFHTTPRequestSerializer</code> å¦å¤–çš„æ ¸å¿ƒ API å¯ä»¥åˆ†ä¸ºç”Ÿæˆ multipart request éƒ¨åˆ†å’Œé multipart request ä¸¤ä¸ªéƒ¨åˆ†æ¥çœ‹ã€‚é¦–å…ˆä»‹ç»é multipart request éƒ¨åˆ†ã€‚å…¶æ¥å£å¦‚ä¸‹ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">NSMutableURLRequest</span> *)requestWithMethod:(<span class="built_in">NSString</span> *)method</span><br><span class="line">                                          URLString:(<span class="built_in">NSString</span> *)URLString</span><br><span class="line">                                         parameters:(<span class="keyword">nullable</span> <span class="type">id</span>)parameters</span><br><span class="line">                                              error:(<span class="built_in">NSError</span> * _Nullable __autoreleasing *)error;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œå…¶å†…éƒ¨ä¸»è¦åšäº†ä¸‰ä»¶äº‹ï¼š</p><ol><li>é€šè¿‡ URLString ç”Ÿæˆä¸€ä¸ª URLRequestï¼Œå¹¶å°†è¯¥è¯·æ±‚çš„ method è®¾ç½®ä¸ºæŒ‡å®šçš„ methodã€‚</li><li>éå†æ›´æ”¹è¿‡çš„å±æ€§åˆ—è¡¨ <code>mutableObservedChangedKeyPaths</code> ï¼Œä½¿ç”¨ <code>setValue:forKey:</code> æ–¹æ³•å»æ”¹å˜ request ä¸­å¯¹åº”å±æ€§çš„å€¼ã€‚</li><li>è°ƒç”¨ä¸Šé¢çš„åºåˆ—åŒ–æ–¹æ³•ï¼Œä¼ å…¥ç”Ÿæˆçš„è¿™ä¸ª request ä»¥åŠå‚æ•°ä¸­çš„ parameters å’Œ errorã€‚</li></ol><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹åºåˆ—åŒ–æ–¹æ³•å†…éƒ¨è¿‡ç¨‹ã€‚å…¶æ–¹æ³•å†…éƒ¨å¤§æ¦‚æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li><code>mutableCopy</code> ä¼ å…¥çš„ requestï¼Œå¹¶å°† serializer å†…éƒ¨ä¹‹å‰è®¾ç½®çš„ headers é€šè¿‡ <code>setValue:forHTTPField:</code> è®¾ç½®åˆ° request ä¸Šã€‚</li><li>å¦‚æœä¼ å…¥çš„ parameters ä¸ä¸ºç©ºï¼Œé¦–å…ˆçœ‹å¤–éƒ¨æœ‰æ²¡æœ‰æŒ‡å®šä¸€ä¸ª block æ¥å¤„ç† parameterï¼ˆé€šè¿‡ä¸€ä¸ª property è®¾ç½®ï¼‰ï¼Œæœ‰å°±é€šè¿‡è¿™ä¸ª block å¤„ç† parametersï¼Œå¦‚æœæ²¡æœ‰å°±å°†å®ƒä»¬è½¬æ¢ä¸º <code>key=value</code> çš„å½¢å¼å¹¶ç”¨ <code>&amp;</code> ä¸²è”æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½œä¸º queryã€‚</li><li>æœ€åå¦‚æœè¯·æ±‚æ–¹æ³•æ˜¯ GET, HEAD, DELETE ä¸­çš„ä¸€ç§ï¼Œå°±ç›´æ¥å§ query æ‹¼æ¥åœ¨ request çš„ URL ä¸Šã€‚å¦‚æœä¸æ˜¯è€Œä¸” request æ²¡æœ‰ <strong>Content-Type</strong> å°±å°†å…¶è®¾ç½®ä¸º <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/POST">application&#x2F;x-www-form-urlencoded</a>ï¼Œç„¶åæŠŠ query è½¬æ¢ä¸º <code>NSData</code> è®¾ç½®åˆ° HTTP çš„ body ä¸Šã€‚</li><li>è¿”å›ä¸Šé¢å¤„ç†å¥½çš„ requestã€‚</li></ol><h3 id="Multipart-request"><a href="#Multipart-request" class="headerlink" title="Multipart request"></a>Multipart request</h3><p>é¦–å…ˆæˆ‘ä»¬è¦æ˜ç™½ multipart request ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„ã€‚ä½¿ç”¨ Postman å‘é€ç½‘ç»œè¯·æ±‚å¯ä»¥æŒ‡å®š body æ ¼å¼ä¸º form-dataï¼ˆmethod ç±»å‹ä¸èƒ½æ˜¯ GET å’Œ HEADï¼‰ï¼Œè¡¨ç¤ºä»¥è¡¨å•å½¢å¼æäº¤ï¼Œè¡¨å•æ•°æ®å°†ä¼šè¢«å¤„ç†æˆä¸€æ¡è¯·æ±‚ï¼Œæ­¤æ—¶å‘é€çš„å°±æ˜¯ä¸€ä¸ª multipart requestã€‚åŒæ—¶å‘é€è¿™ç±»è¯·æ±‚æˆ‘ä»¬å¯ä»¥æŒ‡å®š value æ˜¯ä¸€ä¸ªæ–‡ä»¶ã€‚</p><p><img src="https://res.craft.do/user/full/ea081854-0d6c-dace-b07b-5007ad758cc9/doc/BAA570CA-8DD7-4D68-9E22-C44B50358FF0/A7762D1C-23C0-4C22-BDB5-1B57A4D45E02_2/dxyIZJfqN7r5cBrqTGtYxYWPNlu8HmnqvBvCB3LmOngz/Image.png" alt="Image.png"></p><p>æˆ‘ä»¬æ¥ä¸‹æ¥é€šè¿‡å®é™…å‘é€çš„ HTTP åŒ…æ¥çœ‹ä¸€ä¸‹ multipart request çš„å…·ä½“æ ¼å¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">POST /post HTTP/1.1</span><br><span class="line">User-Agent: PostmanRuntime/7.29.0</span><br><span class="line">Accept: */*</span><br><span class="line">Postman-Token: d3f08e2a-5e01-4f6a-9279-2689018f30eb</span><br><span class="line">Host: httpbin.org</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Content-Type: multipart/form-data; boundary=--------------------------833910809558491007284810</span><br><span class="line">Content-Length: 1250051</span><br><span class="line"></span><br><span class="line">----------------------------833910809558491007284810</span><br><span class="line">Content-Disposition: form-data; name=&quot;Hello&quot;; filename=&quot;Hello.swift&quot;</span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line"></span><br><span class="line">print(&quot;hello world&quot;)</span><br><span class="line">----------------------------833910809558491007284810</span><br><span class="line">Content-Disposition: form-data; name=&quot;image&quot;; filename=&quot;Pid89915350.jpg&quot;</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line"></span><br><span class="line"># image raw data</span><br><span class="line">----------------------------833910809558491007284810</span><br><span class="line">Content-Disposition: form-data; name=&quot;key1&quot;</span><br><span class="line"></span><br><span class="line">value1</span><br><span class="line">----------------------------833910809558491007284810--</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºå…¶å‡ ä¸ªç‰¹ç‚¹ï¼š</p><ul><li><strong>Content-Type</strong> å¯¹åº”çš„å€¼æ˜¯ <strong>multipart&#x2F;form-data</strong> è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª multipart requestã€‚</li><li>Content-Type åé¢æŒ‡å®šäº†ä¸€ä¸ªåˆ†å‰²ç¬¦ boundaryã€‚åç»­åœ¨ body ä¸­ä¹Ÿæ˜¯é€šè¿‡è¿™ä¸ªåˆ†å‰²ç¬¦åˆ†å‰²ä¸åŒçš„é”®å€¼å¯¹ã€‚</li><li>body ä¸­é™¤äº†ç”¨åˆ†å‰²ç¬¦åˆ†å‰²é”®å€¼å¯¹ä¹‹å¤–ï¼Œæ¯ä¸ªé”®å€¼å¯¹éƒ½ä¼šæŒ‡å®š <strong>Content-Disposition</strong> å±æ€§ï¼Œå¦‚æœæ˜¯æ–‡ä»¶ï¼Œè¿˜ä¼šåœ¨åé¢å¸¦ä¸Š filenameã€‚</li><li>å¦‚æœæ˜¯æ–‡ä»¶ï¼Œè¿˜ä¼šæ ¹æ®æ–‡ä»¶ç±»å‹æŒ‡å®š <strong>Content-Type</strong> ã€‚</li></ul><p>äº†è§£å®Œäº† multiple request çš„åŸºæœ¬æ¦‚å¿µï¼Œä¸‹é¢æ¥çœ‹çœ‹ AFNetworking æ¡†æ¶æ€ä¹ˆå¤„ç†è¿™ç§è¯·æ±‚ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€äº›å†…éƒ¨åˆ›å»ºçš„ç±»ï¼ŒAFNetworking é€šè¿‡è¿™äº›ç±»æ¥å¤„ç† multiple request è¯·æ±‚ï¼Œè¿™äº›ç±»ä¼šåœ¨åé¢åˆ›å»º request çš„æµç¨‹ä¸­è¿›è¡Œæ›´è¯¦ç»†çš„ä»‹ç»ï¼š</p><p><img src="https://res.craft.do/user/full/ea081854-0d6c-dace-b07b-5007ad758cc9/doc/BAA570CA-8DD7-4D68-9E22-C44B50358FF0/B94B9153-DB9A-4272-AC7E-97E551F23EB8_2/raPlHT80coNtIOSDen7w3Z74hyjDcOz9v2P2mLC4MY0z/AFMultipartFormData.png" alt="AFMultipartFormData.png"></p><p>AFNetworking é€šè¿‡å¦‚ä¸‹æ–¹æ³•åˆ›å»ºä¸€ä¸ª multipart requestï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSMutableURLRequest</span> *)multipartFormRequestWithMethod:(<span class="built_in">NSString</span> *)method</span><br><span class="line">                                              URLString:(<span class="built_in">NSString</span> *)URLString</span><br><span class="line">                                             parameters:(<span class="built_in">NSDictionary</span> *)parameters</span><br><span class="line">                              constructingBodyWithBlock:(<span class="type">void</span> (^)(<span class="type">id</span> &lt;AFMultipartFormData&gt; formData))block</span><br><span class="line">                                                  error:(<span class="built_in">NSError</span> *__autoreleasing *)error;</span><br></pre></td></tr></table></figure><p>æ–¹æ³•å†…éƒ¨é¦–å…ˆé€šè¿‡ä¸Šé¢çš„ <code>requestWithMethod:URLString:parameters:error:</code> æ–¹æ³•åˆ›å»ºä¸€ä¸ªå¸¦ method çš„ requestï¼Œä½†ç”±äº multipart request ä¸­çš„ parameters çš„ key å¯èƒ½æ˜¯æ–‡ä»¶ï¼Œå› æ­¤è°ƒç”¨è¯¥æ–¹æ³•æ—¶ parameters å‚æ•°ä¼ å…¥çš„æ˜¯ <code>nil</code> ã€‚</p><p>éšåä½¿ç”¨è¯¥åˆ›å»ºçš„ request åˆå§‹åŒ–ä¸€ä¸ª <code>AFStreamingMultipartFormData</code> ï¼Œè¯¥ç±»åœ¨åˆå§‹åŒ–æ—¶ä¼šéšæœºç”Ÿæˆ multipart request éœ€è¦çš„åˆ†å‰²ç¬¦ï¼ˆboundaryï¼‰ã€‚åŒæ—¶å†…éƒ¨åˆå§‹åŒ–ä¸€ä¸ª <code>AFMultipartBodyStream</code> ä½œä¸ºå…¶å±æ€§ ï¼Œè¯¥ç±»ç»§æ‰¿äº† <code>NSInputStream</code> å¹¶å®ç°äº† <code>NSStreamDelegate</code> ä¸­çš„æ–¹æ³•ã€‚å†å¯¹æ•°æ®è¿›è¡Œå¤„ç†åå°†åœ¨æœ€åè¢«è®¾ç½®åˆ° request çš„ httpBodyStream ä¸Šã€‚</p><p>åˆ›å»ºç»“æŸåï¼Œå†…éƒ¨ä¼šéå† parametersï¼Œå¯¹é‚£äº›ä¸æ˜¯ <code>NSData</code> çš„ value è¿›è¡Œè½¬æ¢ï¼ˆå¯èƒ½æ˜¯æ™®é€šå­—ç¬¦ç±»å‹ï¼‰ï¼Œç»Ÿä¸€æˆ <code>NSData</code> ç±»å‹ï¼Œéšåè°ƒç”¨ <code>AFStreamMultipartFormData</code> çš„ <code>appendPartWithFormData:name:</code> æ–¹æ³•å°†å…¶æŒ¨ä¸ªåŠ å…¥åˆ° form data ä¸­ã€‚è¿™ä¸ªæ·»åŠ è¿‡ç¨‹åˆåˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p><ol><li>é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª dictionaryï¼Œç„¶åè®¾ç½®äº† <strong>Content-Disposition</strong> å€¼ã€‚</li><li>éšååˆ›å»ºäº†ä¸€ä¸ª <code>AFHTTPBodyPart</code> å®ä¾‹ï¼Œæ¯ä¸€ä¸ª <code>AFHTTPBodyPart</code> çš„å®ä¾‹ï¼Œå…¶å®å°±æ˜¯ä»£è¡¨äº†ä¸Šé¢æˆ‘ä»¬çœ‹åˆ°äº† multipart request HTTP å¤´é‡Œé¢ä¸¤ä¸ªåˆ†å‰²çº¿ä¹‹é—´çš„ä¸€å—å†…å®¹ï¼ˆä¸€ä¸ªé”®å€¼å¯¹ï¼‰ã€‚åˆ›å»ºåå°†ä¸Šé¢è®¾ç½®è¿‡çš„ dictionary ä½œä¸ºäº† bodyPart çš„ headersï¼Œä¼ å…¥çš„ data ä½œä¸ºå…¶ bodyï¼ŒåŒæ—¶è®¾ç½®äº†åˆ†å‰²ç¬¦å’Œ content lengthã€‚</li><li>æœ€åå°†ç”Ÿæˆçš„è¿™ä¸ª body part åŠ åˆ°ä¸Šé¢ç”Ÿæˆçš„ body stream é‡Œé¢ã€‚è¿™ä¸ªåŠ å…¥é€»è¾‘å®é™…ä¸Šå°±æ˜¯å°†è¿™ä¸ªæ–°ç”Ÿæˆ body part æ”¾åˆ°äº†å†…éƒ¨çš„ä¸€ä¸ª array ä¸­ã€‚</li></ol><p>éšåä¼šè°ƒç”¨å‚æ•°ä¸­çš„ blockï¼Œå¹¶å°†åˆ›å»ºçš„ formData å®ä¾‹ä¼ å…¥ã€‚åœ¨ block ä¸­ï¼Œä½¿ç”¨è€…å¯ä»¥è°ƒç”¨ <code>AFMultipartFormData</code> åè®®ä¸­çš„ä¸€äº›å…¶ä»–æ–¹æ³•ï¼Œå°†æ•°æ®æ·»åŠ åˆ° multipart request çš„ body ä¸­ã€‚æ¯”å¦‚:</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">BOOL</span>)appendPartWithFileURL:(<span class="built_in">NSURL</span> *)fileURL</span><br><span class="line">                         name:(<span class="built_in">NSString</span> *)name</span><br><span class="line">                        error:(<span class="built_in">NSError</span> * __autoreleasing *)error</span><br></pre></td></tr></table></figure><p>ä¼šé€šè¿‡åœ¨å†…éƒ¨è®¾ç½® <strong>Content-Disposition</strong> å’Œ <strong>Content-Type</strong> ï¼ŒåŒæ ·ä¹Ÿç”Ÿæˆä¸€ä¸ª <code>AFHTTPBodyPart</code> å®ä¾‹ï¼Œå¹¶è®¾ç½®å…¶ headersã€bodyï¼ˆè®¾ç½®ä¸ºè¿™é‡Œçš„ fileURLï¼‰ç­‰å±æ€§ï¼Œæœ€åæ·»åŠ åˆ° body stream é‡Œé¢ã€‚</p><p>multipart request æ–¹æ³•æœ€åä¼šè°ƒç”¨ form data çš„ <code>requestByFinalizingMultipartFormData</code> æ–¹æ³•ç”Ÿæˆä¸€ä¸ª request è¿”å›ã€‚è¯¥æ–¹æ³•å†…éƒ¨ç”Ÿæˆäº†ä¸€ä¸ª requestï¼Œè®¾ç½®äº†å…¶ <strong>Content-Type</strong> ä¸º <strong>multipart&#x2F;form-data; boundary&#x3D;â€¦</strong>ï¼ŒåŒæ—¶ <strong>Content-Length</strong> ä¸º body stream çš„å¤§å°<strong>ã€‚</strong>å¹¶è®¾ç½®äº†å…¶ http body stream ä¸ºä¸Šé¢çš„ <code>AFMultipartBodyStream</code> å®ä¾‹ã€‚å¦å¤–è¿˜æŒ‡å®šåªæœ‰ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ª body part åˆ†åˆ«éœ€è¦åˆå§‹åˆ†å‰²ç¬¦å’Œç»“æŸåˆ†å‰²ç¬¦ã€‚</p><p>ç”±äº <code>AFMultipartBodyStream</code> ç»§æ‰¿äº† <code>NSInputStream</code> ï¼Œå®é™…è¦å»çœ‹å‘é€æ—¶å¦‚ä½•å¤„ç†å†…éƒ¨çš„ headers å’Œ body è¿˜æ˜¯éœ€è¦å»çœ‹å®ƒå¦‚ä½•é‡å†™äº† <code>read:maxLength:</code> æ–¹æ³•ã€‚è¯¥æ–¹æ³•å†…éƒ¨å®ç°å°±æ˜¯éå†å†…éƒ¨çš„æ‰€æœ‰ <code>AFHTTPBodyPart</code> å®ä¾‹ç„¶åè°ƒç”¨æ¯ä¸€ä¸ªå®ä¾‹çš„ <code>read:maxLength:</code> æ–¹æ³•ã€‚</p><p>è¯¥æ–¹æ³•å†…éƒ¨é€šè¿‡ <code>AFHTTPBodyPart</code> ä¸­å®šä¹‰çš„å¦‚ä¸‹æšä¸¾ç±»ï¼Œåˆ†é˜¶æ®µå°†æ•°æ®åˆ†å¸ƒå†™è¿› buffer ä¸­ï¼Œæ¯æ¬¡å†™å®Œä¸€ä¸ªé˜¶æ®µå°±ä¼šå‰å¾€ä¸‹ä¸€ä¸ªé˜¶æ®µã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> &#123;</span><br><span class="line">    AFEncapsulationBoundaryPhase = <span class="number">1</span>, <span class="comment">// å†™åˆå§‹åˆ†å‰²ç¬¦æˆ–è€…ä¸­é—´åˆ†å‰²ç¬¦çš„é˜¶æ®µ</span></span><br><span class="line">    AFHeaderPhase                = <span class="number">2</span>, <span class="comment">// å†™ headers çš„é˜¶æ®µï¼ŒåŒ…æ‹¬ content-dispostion ç­‰</span></span><br><span class="line">    AFBodyPhase                  = <span class="number">3</span>, <span class="comment">// å†™ body çš„é˜¶æ®µ</span></span><br><span class="line">    AFFinalBoundaryPhase         = <span class="number">4</span>, <span class="comment">// å†™ç»“å°¾åˆ†å‰²ç¬¦çš„é˜¶æ®µï¼Œåªæœ‰æœ€åä¸€ä¸ª body part æœ‰è¿™ä¸ªé˜¶æ®µ</span></span><br><span class="line">&#125; AFHTTPBodyPartReadPhase;</span><br></pre></td></tr></table></figure><p>ç¬¬ 1ã€2ã€4 é˜¶æ®µéƒ½æ˜¯å°†å­—ç¬¦ä¸²è½¬æ¢ä¸º <code>NSData</code> ç„¶åå†™å…¥ï¼Œ2 é˜¶æ®µå†™å…¥å‰ï¼Œä¼šè®²æ‰€æœ‰çš„ headers ä»¥ <code>key: value</code> çš„å½¢å¼æ‹¼æ¥èµ·æ¥ï¼Œå¹¶ä»¥æ¢è¡Œç¬¦ä¸²è”æˆä¸€ä¸ªæ•´çš„å­—ç¬¦ä¸²ã€‚</p><p>ç¬¬ 3 é˜¶æ®µåˆ™ä¼šæ ¹æ®å½“å‰ body çš„ç±»å‹ï¼ˆ<code>NSData</code> <code>NSURL</code> æˆ–è€… <code>NSInputStream</code>ï¼‰åˆå§‹åŒ–ä¸€ä¸ª <code>NSInputStream</code> ï¼Œå¹¶ä»ä¸­è¯»å–ã€‚</p><p>ä»¥ä¸Šå°±æ˜¯æ•´ä¸ª multipart request ç”Ÿæˆå’Œå¤„ç†çš„è¿‡ç¨‹ã€‚</p><p><code>AFHTTPRequestSerializer</code> çš„ä¸¤ä¸ªå­ç±» <code>AFJSONRequestSerializer</code> å’Œ <code>AFPropertyListRequestSerializer</code> å…¶çˆ¶ç±»çš„å¤„ç†ç±»ä¼¼ã€‚ä¸è¿‡åˆ†åˆ«å°† <strong>Content-Type</strong> è®¾ç½®ä¸ºäº† <strong>application&#x2F;json</strong> å’Œ <strong>application&#x2F;x-plist</strong> ã€‚æœ€åè¿˜æ˜¯å°†å¯¹åº”æ ¼å¼çš„æ•°æ®è½¬æ¢ä¸ºäº† <code>NSData</code> è®¾ç½®åˆ°äº† HTTP body ä¸Šã€‚</p><h2 id="AFHTTPResponseSerializer"><a href="#AFHTTPResponseSerializer" class="headerlink" title="AFHTTPResponseSerializer"></a>AFHTTPResponseSerializer</h2><p>å¯¹ response è¿›è¡Œæ ¼å¼åŒ–çš„ç±»ç›¸å¯¹è€Œè¨€æ¯”è¾ƒç®€å•ï¼Œå®é™…ä½¿ç”¨æ—¶ä¸»è¦ä½¿ç”¨ <code>AFHTTPResponseSerializer</code> çš„ç‰¹å®šæ ¼å¼çš„å­ç±»ï¼Œå¦‚ <code>AFJSONResponseSerializer</code> , <code>AFXMLParserResponseSerializer</code> ç­‰ã€‚</p><p>æ ¸å¿ƒä½œç”¨æ˜¯é€šè¿‡ä»¥ä¸‹æ–¹æ³•å°† response è§£ææˆå¯¹è±¡ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">id</span>)responseObjectForResponse:(<span class="built_in">NSURLResponse</span> *)response</span><br><span class="line">                           data:(<span class="built_in">NSData</span> *)data</span><br><span class="line">                          error:(<span class="built_in">NSError</span> *__autoreleasing *)error;</span><br></pre></td></tr></table></figure><p>å…¶ä¸»è¦è¿‡ç¨‹é¦–å…ˆæ˜¯æ£€æŸ¥çŠ¶æ€ç çœ‹è¯·æ±‚æ˜¯å¦æˆåŠŸï¼Œç„¶åæ£€æŸ¥ä¸€äº› response çš„å‚æ•°æ˜¯å¦é½å…¨ï¼Œå¦‚ <strong>Content-Type</strong> ï¼Œéšåè¿˜ä¼šæ£€æŸ¥å…¶ä¸­çš„ <strong>Content-Type</strong> æ˜¯å¦æ˜¯å¯¹åº”çš„æ ¼å¼ï¼ˆå¦‚ä½¿ç”¨ <code>AFJSONResponseSerializer</code> è¦æ±‚å€¼ä¸º <code>@&quot;application/json&quot;, @&quot;text/json&quot;, @&quot;text/javascript&quot;</code> ä¸­çš„ä¸€ç§ï¼‰ã€‚æœ€åä½¿ç”¨å¯¹åº”çš„è§£æå™¨å°†æ•°æ®è§£æä¸ºå¯¹è±¡ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç ”ç©¶äº† AFNetworking ç½‘ç»œæ¡†æ¶çš„ä¸»è¦ç»“æ„å’Œæ–¹æ³•ï¼Œå¯¹å…¶å†…éƒ¨å¦‚ä½•å»ºç«‹ä¸€ä¸ªè¯·æ±‚ï¼Œåšäº†å“ªäº›é¢å¤–å·¥ä½œï¼Œç‰¹åˆ«æ˜¯å¦‚ä½•å‘é€ä¸€ä¸ª multipart request è¯·æ±‚è¿›è¡Œäº†è¾ƒä¸ºæ·±å…¥çš„åˆ†æã€‚&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>ğŸ± iOS è‡ªåŠ¨å¸ƒå±€å’Œ Masonry æ¡†æ¶</title>
    <link href="http://example.com/2022/03/28/%F0%9F%8D%B1%20iOS%20%E8%87%AA%E5%8A%A8%E5%B8%83%E5%B1%80%E5%92%8C%20Masonry%20%E6%A1%86%E6%9E%B6/"/>
    <id>http://example.com/2022/03/28/%F0%9F%8D%B1%20iOS%20%E8%87%AA%E5%8A%A8%E5%B8%83%E5%B1%80%E5%92%8C%20Masonry%20%E6%A1%86%E6%9E%B6/</id>
    <published>2022-03-28T03:28:00.000Z</published>
    <updated>2022-04-27T13:47:10.525Z</updated>
    
    <content type="html"><![CDATA[<p>ç®€å•ä»‹ç»äº†ä¸€äº›å…³äº iOS è‡ªåŠ¨å¸ƒå±€çš„æ¦‚å¿µï¼Œå¹¶å¯¹ Masonry æ¡†æ¶è¿›è¡Œäº†åˆ†æã€‚ä¸»è¦ä»‹ç»äº† Masonry æ¡†æ¶ä¸»è¦ç»“æ„ï¼Œä½¿ç”¨æ—¶å†…éƒ¨è°ƒç”¨è¿‡ç¨‹å’Œä¸€äº›éœ€è¦æ³¨æ„çš„ç»†èŠ‚ã€‚</p><span id="more"></span><h2 id="iOS-å¸ƒå±€æ–¹æ³•"><a href="#iOS-å¸ƒå±€æ–¹æ³•" class="headerlink" title="iOS å¸ƒå±€æ–¹æ³•"></a>iOS å¸ƒå±€æ–¹æ³•</h2><p>iOS å‘å±•æ—©æœŸç”±äºè®¾å¤‡å±å¹•å¤§å°å›ºå®šï¼Œå› æ­¤ä¸éœ€è¦è€ƒè™‘å±å¹•å¤§å°å·®å¼‚äº§ç”Ÿçš„é€‚é…é—®é¢˜ï¼Œé‡‡ç”¨çš„æ˜¯ç›´æ¥æŒ‡å®š View çš„ä½ç½®å’Œå¤§å°ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIView</span> *view = [[<span class="built_in">UIView</span> alloc] init];</span><br><span class="line"><span class="comment">// æŒ‡å®š view çš„å·¦ç«¯ï¼Œä¸Šç«¯è·ç¦»çˆ¶ view çš„è·ç¦»ä¸º10ï¼Œå®½é«˜å‡ä¸º 50</span></span><br><span class="line">view.frame = <span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">50</span>);</span><br></pre></td></tr></table></figure><p>è®¾å®šä¸€ä¸ª view çš„å¸ƒå±€ï¼Œéœ€è¦æ¯æ¬¡éƒ½å¯¹ä»¥ä¸Šå±æ€§è¿›è¡Œè®¡ç®—ã€‚å½“éœ€è¦æ”¹å˜æ—¶ï¼Œéœ€è¦å¯¹ä¸Šé¢çš„4ä¸ªå±æ€§è¿›è¡Œé‡æ–°è®¡ç®—ã€‚</p><p>åæ¥è‹¹æœå¯¹æ¯ä¸€ä¸ª view æ·»åŠ äº† <code>autoresizingMask</code> å±æ€§ï¼Œèƒ½å¤Ÿè®©ä¸€ä¸ª view åœ¨çˆ¶ view è¿›è¡Œå˜åŠ¨æ—¶æ ¹æ®è¿™ä¸ªå±æ€§æ¥è¿›è¡Œè°ƒæ•´ã€‚å¦‚ <code>UIViewAutoresizingFlexibleLeftMargin</code> è¡¨ç¤ºè¯¥ view åœ¨çˆ¶ view å˜åŠ¨æ—¶ï¼Œå·¦è¾¹è¾¹è·å¯ä»¥è¿›è¡Œå˜åŒ–ã€‚å¯ä»¥ä½¿ç”¨ä½ä¸è¿ç®—è¿æ¥å¤šä¸ªè¿™æ ·çš„å±æ€§ã€‚</p><p>autoresizingMask ä¹Ÿå­˜åœ¨å…¶å±€é™æ€§ï¼Œç”±äºå…¶åªèƒ½è®¾ç½®å’Œçˆ¶ view ä¹‹é—´çš„å…³ç³»ï¼Œç¼ºä¹çµæ´»æ€§ï¼Œåªèƒ½ç”¨äºä¸€å°éƒ¨åˆ†çš„çº¦æŸè®¾ç½®ã€‚</p><p>ä¹‹åä» iOS6 å¼€å§‹ï¼Œè‹¹æœå¼•å…¥äº†è‡ªåŠ¨å¸ƒå±€ï¼Œé€šè¿‡ä¸€ç§çº¦æŸæ¥è®¾ç½® view ä¹‹é—´çš„å…³ç³»ï¼Œå¸®åŠ©å¼€å‘è€…æ›´æ–¹ä¾¿å¿«æ·çš„é€‚é…å¤šç§å¤§å°çš„å±å¹•ã€‚</p><p>ä¸€ä¸ªçº¦æŸï¼ˆconstraintï¼‰é€šå¸¸å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªä»¥ä¸‹çš„ç­‰å¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Item A&#x27;s Attribute = Multiplier * Item B&#x27;s Attribute + Constant</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ‰€æœ‰ view ä¸Šçš„çº¦æŸï¼Œè½¬æ¢ä¸ºä¸€ä¸ªçº¿æ€§è§„åˆ’é—®é¢˜ï¼Œå¹¶æœ€ç»ˆè¿›è¡Œæ±‚è§£ï¼Œè¯¦æƒ…å¯å‚è€ƒè®ºæ–‡ <a href="https://constraints.cs.washington.edu/solvers/uist97.pdf">ã€ŠSolving Linear Arithmetic Constraints for User Interface Applicationsã€‹</a>ã€‚</p><blockquote><p>ç”±äºè‡ªåŠ¨å¸ƒå±€æ¶‰åŠåˆ°è®¡ç®—ï¼Œå› æ­¤é€šå¸¸æ€§èƒ½ä¼šè¾ƒ frame çš„å¸ƒå±€æ–¹å¼å·®ã€‚</p></blockquote><h2 id="Masonry"><a href="#Masonry" class="headerlink" title="Masonry"></a>Masonry</h2><p>ç”±äºå®˜æ–¹æä¾›çš„è‡ªåŠ¨å¸ƒå±€ api è¾ƒä¸ºç¹çï¼Œé€šå¸¸è®¾ç½®ä¸€ä¸ªçº¦æŸå°±è¦å†™ä¸‹å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// view1 ä¸Šç«¯è·ç¦» view2 ä¸Šç«¯ 10</span></span><br><span class="line">[<span class="built_in">NSLayoutConstraint</span> constraintWithItem:view1</span><br><span class="line">                             attribute:<span class="built_in">NSLayoutAttributeTop</span></span><br><span class="line">                             relatedBy:<span class="built_in">NSLayoutRelationEqual</span></span><br><span class="line">                                toItem:view2</span><br><span class="line">                             attribute:<span class="built_in">NSLayoutAttributeTop</span></span><br><span class="line">                            multiplier:<span class="number">1.0</span></span><br><span class="line">                              constant:padding.top]</span><br></pre></td></tr></table></figure><p>å› æ­¤åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨ <a href="https://github.com/SnapKit/Masonry">Masonry</a> æ¡†æ¶è¿›è¡Œå¼€å‘ï¼ŒMasonry æ¡†æ¶å°è£…äº†å®˜æ–¹ api å¹¶æä¾›äº†ä¸€ç§ç®€å•çš„é“¾å¼è°ƒç”¨è¯­æ³•ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¹Ÿæ˜¯ view1 ç¦» view2 é¡¶éƒ¨æœ‰ 10 çš„è·ç¦»</span></span><br><span class="line">[view1 mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">    make.top.mas_equalTo(view2.mas_top).mas_offset(<span class="number">10</span>);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure><p>è€Œåœ¨æ·»åŠ å¤šä¸ªçº¦æŸæ—¶ï¼ŒMasonry ä¼šæ›´åŠ æ–¹ä¾¿ã€‚</p><p>é€šè¿‡å­¦ä¹  Masonry çš„æºç ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè¿›ä¸€æ­¥äº†è§£è‡ªåŠ¨å¸ƒå±€ï¼Œå¹¶å‡å°‘åœ¨æ—¥å¸¸å¼€å‘ä¸­å¼•å…¥çš„å¸ƒå±€é—®é¢˜ã€‚</p><p>Masonry ä¸­çš„ <code>MASViewAttribute</code> ä»£è¡¨äº†å…¬å¼ä¸­çš„ä¸€ä¸ª item and Attributeã€‚<code>MASConstraints</code> ä»£è¡¨äº†ä¸Šæ–‡ä¸­çš„ä¸€ä¸ªçº¦æŸå…¬å¼ï¼Œæœ€ç»ˆé€šè¿‡å®˜æ–¹çš„ api æ¿€æ´»æˆ <code>NSLayoutConstraints</code> åŠ åˆ°viewä¸Šé¢ã€‚</p><p>Masonry ä¸­çš„ä¸€äº›ç±»å¤§è‡´å…³ç³»å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://res.craft.do/user/full/ea081854-0d6c-dace-b07b-5007ad758cc9/doc/0F73AF4D-EB6C-437C-9640-A7EA15797C87/0FE954FF-5CEF-4346-B71A-CF09E47B9D10_2/O5fsv2WRqFy69E0Gv7UOsopv4bod0jOb7chSbOYxqJ8z/Masonry.png" alt="Masonry.png"></p><p>ä¸‹æ–‡ä¸­æˆ‘ä»¬å°†é¦–å…ˆå¯¹ä¸€äº›ç±»è¿›è¡Œåˆ†æï¼Œæœ€åè¿›è¡Œ3ä¸ªæ—¥å¸¸ä¸­æœ€å¸¸è§å®ä¾‹çš„åˆ†æï¼Œè¿›ä¸€æ­¥äº†è§£æ•´ä¸ªæ¡†æ¶çš„å·¥ä½œè¿‡ç¨‹ã€‚</p><h3 id="View-MASAdditions"><a href="#View-MASAdditions" class="headerlink" title="View+MASAdditions"></a>View+MASAdditions</h3><p>å®šä¹‰äº†ä¸€äº› <code>MASViewAttribute</code> å±æ€§ï¼Œå¦‚ <code>mas_top</code> ç­‰ã€‚è¿™äº›å±æ€§çš„ getter éƒ½æ˜¯ä¼ å…¥ self ä½œä¸º viewï¼Œå¹¶ä¼ å…¥å¯¹åº”çš„ <code>NSLayoutAttribute</code> å¯¹ <code>MASViewAttribute</code> è¿›è¡Œåˆå§‹åŒ–ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (MASViewAttribute *)mas_top &#123;</span><br><span class="line">    <span class="keyword">return</span> [[MASViewAttribute alloc] initWithView:<span class="keyword">self</span> layoutAttribute:<span class="built_in">NSLayoutAttributeTop</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>MASViewAttribute</code> ä¸»è¦åŒ…æ‹¬ä¸€ä¸ª view å’Œä¸€ä¸ª <code>NSLayoutAttribute</code>ã€‚</p></blockquote><p>å®šä¹‰äº† <code>mas_makeConstraints</code>, <code>mas_updateConstraints</code> å’Œ <code>mas_remakeConstraints</code> ä¸‰ä¸ªæ–¹æ³•ã€‚è¿™ä¸‰ä¸ªæ–¹æ³•ä¹Ÿæ˜¯ä½¿ç”¨ Masonry çš„æ ¸å¿ƒæ–¹æ³•ï¼Œåˆ†åˆ«çš„ä½¿ç”¨åœºæ™¯ä¸ºï¼š</p><ul><li><code>mas_makeConstraints</code>ï¼šæœ€åˆåˆ›å»º constraints æ—¶ä½¿ç”¨ã€‚</li><li><code>mas_updateConstraints</code>ï¼šå¯¹äºæŸä¸ª constraint çš„å¸¸æ•°è¿›è¡Œæ›´æ”¹æ—¶ä½¿ç”¨ï¼Œæ³¨æ„è¯¥æ–¹æ³•åªèƒ½æ›´æ–° constraint çš„å¸¸æ•°ã€‚å¦‚æœå¸Œæœ›é‡æ–°è®¾ç½®é’ˆå¯¹çš„ viewï¼Œéœ€è¦ä½¿ç”¨ <code>mas_remakeConstraints</code>ã€‚åŸå› å°†åœ¨åé¢å®ä¾‹åˆ†æçš„æœ€åæ­¥éª¤ä¸­è¿›è¡Œè¿›ä¸€æ­¥è®²è§£ã€‚</li><li><code>mas_remakeConstraints</code> å°†ä¼šç§»é™¤ä¹‹å‰çš„æ‰€æœ‰ constraintï¼Œå¹¶è¿›è¡Œé‡æ–°è®¾ç½®ï¼Œæ³¨æ„ä¸€å®šè¦ä¿è¯é‡æ–°è®¾ç½®åçš„ constraint ä¾ç„¶èƒ½å¤Ÿå®Œæ•´çš„ç¡®å®šè¯¥ view çš„ä½ç½®å’Œå¤§å°ã€‚</li></ul><p>ä¸Šé¢ä¸‰ä¸ªæ–¹æ³•æµç¨‹ä¸€è‡´ï¼Œéƒ½æ˜¯åˆ›å»ºäº†ä¸€ä¸ª <code>MASConstraintMaker</code>ï¼Œå¹¶å°†å…¶ä½œä¸ºå‚æ•°ä¼ å…¥æ–¹æ³•å‚æ•°çš„ block ä¸­ã€‚æœ€åè°ƒç”¨ <code>[MASConstraintMaker install]</code>ã€‚å…¶ä¸­ update è®¾ç½®äº† installer çš„ <code>updateExisting</code> ä¸º YESï¼Œremake è®¾ç½®äº† installer çš„ <code>removeExisting</code> ä¸º YESã€‚</p><p><code>translatesAutoresizingMaskIntoConstraints</code> å±æ€§ä¸º YESï¼Œå°†ä¼šæŠŠå¯¹ frame çš„è®¾ç½®è‡ªåŠ¨è½¬æ¢ä¸ºè‡ªåŠ¨å¸ƒå±€çº¦æŸï¼Œä½†è¿™ç§è‡ªåŠ¨è½¬æ¢å¯èƒ½ä¼šå¸¦æ¥çº¦æŸä¸Šçš„å†²çªï¼Œå› æ­¤è®¾ç½®ä¸º NOï¼Œä¼šå°†å¯¹ frame çš„è®¾ç½®å¿½ç•¥ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSArray</span> *)mas_makeConstraints:(<span class="type">void</span>(^)(MASConstraintMaker *))block &#123;</span><br><span class="line">    <span class="keyword">self</span>.translatesAutoresizingMaskIntoConstraints = <span class="literal">NO</span>;</span><br><span class="line">    MASConstraintMaker *constraintMaker = [[MASConstraintMaker alloc] initWithView:<span class="keyword">self</span>];</span><br><span class="line">    block(constraintMaker);</span><br><span class="line">    <span class="keyword">return</span> [constraintMaker install];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™ä¸‰ä¸ªæ–¹æ³•å¤´æ–‡ä»¶ä¸­å¯¹ block åŠ äº† <code>void(^NS_NOESCAPE)</code> é™åˆ¶ï¼Œè¡¨ç¤ºè¯¥ block ä¼šåœ¨æ–¹æ³•ç»“æŸå‰è¢«è°ƒç”¨å®Œæˆï¼Œç¼–è¯‘å™¨èƒ½åˆ©ç”¨è¿™ä¸ªä¿¡æ¯æ›´å¥½çš„ç®¡ç†å†…å­˜ï¼ŒåŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦ä¼ å…¥ weak selfã€‚</p></blockquote><blockquote><p>objective-c é»˜è®¤æ˜¯ escapingï¼ŒSwift é»˜è®¤æ˜¯ no escapeï¼ŒSwift ä¸­ä½¿ç”¨ <code>@escaping</code> å…³é”®å­—ã€‚</p></blockquote><h3 id="View-MASShorthandAdditions"><a href="#View-MASShorthandAdditions" class="headerlink" title="View+MASShorthandAdditions"></a>View+MASShorthandAdditions</h3><p>å¦‚æœå®šä¹‰äº† <code>MAS_SHORTHAND</code> å®ï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>top</code> ä»£æ›¿ <code>mas_top</code>ï¼Œä½¿ç”¨ <code>makeConstraints</code> ä»£æ›¿ <code>mas_makeConstraints</code>ï¼Œè¿™äº›ç¼©å†™çš„å®šä¹‰ï¼Œå®é™…ä¸Šè¿˜æ˜¯è°ƒç”¨äº†æœ‰ <code>mas_</code> å¼€å¤´çš„æ–¹æ³•å’Œå±æ€§ã€‚</p><p>æœäº†ä¸‹ä¸»ç«™é‡Œé¢æ²¡æœ‰åœ°æ–¹æœ‰ <code>#define MAS_SHORTHAND</code>ã€‚å› æ­¤åœ¨ä¸»ç«™å¼€å‘ä¸­æŒ‰ç…§æ ‡å‡†å†™æ³•è¿˜æ˜¯åº”è¯¥è°ƒç”¨å¸¦æœ‰ <code>mas_</code> çš„å±æ€§ã€‚</p><blockquote><p>ğŸ“Œ å¯¹ä¸»ç«™é‡Œé¢æœ‰å†™ç¼©å†™çš„åœ°æ–¹ jump to definition è·³è½¬åˆ°äº† UIView+KSGeometryã€‚ç¼–è¯‘å™¨æ²¡æœ‰å¯¹äºä¸€äº›åœ°æ–¹ç±»ä¼¼äºä½¿ç”¨ <code>.bottom</code> ä»£æ›¿ <code>.mas_bottom</code> çš„å†™æ³•æ²¡æœ‰æŠ¥é”™çš„åŸå› åªæ˜¯å› ä¸ºå·¥ç¨‹å†…éƒ¨å®ç°äº†ä¸€ä¸ªèƒ½è¿”å› view åº•éƒ¨ view ä½ç½®æµ®ç‚¹æ•°çš„æ–¹æ³•ï¼Œä½†è¿™ç§å†™æ³•å…¶å®åœ¨ <code>mas_equalTo</code> ä¸­ä¼ å…¥çš„æ˜¯ä¸€ç§ç»å¯¹å€¼ï¼Œå®é™…æä¾›çš„çº¦æŸè§„åˆ™æ˜¯ç›¸å¯¹äº superview å¤šå°‘ä¸ªåƒç´ ï¼ˆä¼ å…¥å¸¸æ•°æ—¶ï¼Œå°†ä¼šè®¾ç½®æˆç›¸å¯¹äºå…¶ superview å¯¹åº”æ–¹ä½çš„è·ç¦»ï¼‰ï¼Œå¯èƒ½åç»­ç»´æŠ¤çš„æ—¶å€™ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ã€‚</p></blockquote><p>æˆ‘è¿›ä¸€æ­¥åœ¨ä¸»ç«™å†…å¯¹ä¸Šé¢è¿›è¡Œå°è¯•äº†ä¸€ä¸‹ï¼Œå¦‚æœæ˜¯åŒæ—¶è¿›è¡Œè‡ªåŠ¨å¸ƒå±€çš„ä¸€ä¸ªå¦ä¸€ä¸ª view2 å¯¹å…¶çš„å±æ€§ä½¿ç”¨æ‰€å†™çš„æ–¹å¼ï¼Œç”±äºå…¶æ²¡æ¸²æŸ“å®Œï¼Œä¸€èˆ¬ä¼šè¿”å›0ï¼Œæ­¤æ—¶åœ¨æŸäº›æƒ…å†µä¸‹æ˜¯ä¸ä¼šæœ‰é—®é¢˜çš„ï¼Œæ¯”å¦‚ view2 æ˜¯ view1 çš„çˆ¶ viewï¼Œå¦‚ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIView</span> *view1 = [[<span class="built_in">UIView</span> alloc] init];</span><br><span class="line"><span class="built_in">UIView</span> *view2 = [[<span class="built_in">UIView</span> alloc] init];</span><br><span class="line">[view1 addSubview:view2];</span><br><span class="line"></span><br><span class="line">[view2 mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">    make.top.mas_equalTo(view1.top).mas_equalTo(<span class="number">10</span>);</span><br><span class="line">    ...</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ç”±äº view1.top å–åˆ°çš„æ˜¯ 0ï¼Œç›¸å½“äºè®¾å®š view2 çš„é¡¶éƒ¨è·ç¦»å…¶ superview æ˜¯ 0+10ï¼Œå’Œé¢„æœŸæ˜¯ç›¸åŒçš„ã€‚å› æ­¤ä¸ä¼šå‡ºé”™ã€‚</p><p>å¦ä¸€ç§å¯èƒ½æ€§å¯èƒ½æ˜¯çœ‹èµ·æ¥ä¸ä¼šå‡ºé”™ï¼Œæ¯”å¦‚è®¾å®šç›¸å¯¹äº view controller é‡Œé¢ view çš„ bottomï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in a view controller</span></span><br><span class="line"><span class="built_in">UIView</span> *view = [[<span class="built_in">UIView</span> alloc] init];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:view];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[view mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">    ...</span><br><span class="line">    make.bottom.mas_equalTo(<span class="keyword">self</span>.view.bottom);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure><p>å‡è®¾æ ¹æ®åˆ†ç±»çš„å®šä¹‰ï¼Œè¿™ä¸ªæ—¶å€™ <code>self.view.bottom</code> è¿”å›äº† 1000 å…¶å®ç›¸å½“äºè®¾ç½® <code>make.bottom.mas_equalTo(self.view.mas_bottom).mas_offset(1000)</code>ï¼Œä½†ç”±äºå¤šå‡ºçš„éƒ¨åˆ†éƒ½åœ¨å±å¹•å¤–é¢ï¼Œå› æ­¤çœ‹èµ·æ¥å’Œæ­£ç¡®çš„è®¾ç½®æ–¹å¼æ²¡æœ‰åŒºåˆ«ã€‚</p><h3 id="NSArray-MASAdditions"><a href="#NSArray-MASAdditions" class="headerlink" title="NSArray+MASAdditions"></a>NSArray+MASAdditions</h3><p>åŒæ ·æä¾›äº† <code>mas_makeConstraints</code>, <code>mas_updateConstraints</code> å’Œ <code>mas_remakeConstraints</code> ä¸‰ä¸ªæ–¹æ³•ã€‚é€šè¿‡æ•°ç»„è°ƒç”¨è¿™ä¸‰ä¸ªæ–¹æ³•æ—¶ï¼Œè¦ä¿è¯æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯ <code>UIView</code> ç±»å‹ï¼Œè¿™ä¸‰ä¸ªæ–¹æ³•çš„è°ƒç”¨å†…éƒ¨ä¼šéå†æ•´ä¸ªæ•°ç»„å†…çš„æ‰€æœ‰ viewï¼Œå¹¶é’ˆå¯¹æ¯ä¸ª view è°ƒç”¨å¯¹åº”çš„æ–¹æ³•æ¥è®¾ç½® view çš„çº¦æŸã€‚</p><p>å¤šæä¾›äº†ä¸¤ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)mas_distributeViewsAlongAxis:(MASAxisType)axisType withFixedSpacing:(<span class="built_in">CGFloat</span>)fixedSpacing leadSpacing:(<span class="built_in">CGFloat</span>)leadSpacing tailSpacing:(<span class="built_in">CGFloat</span>)tailSpacing;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)mas_distributeViewsAlongAxis:(MASAxisType)axisType withFixedItemLength:(<span class="built_in">CGFloat</span>)fixedItemLength leadSpacing:(<span class="built_in">CGFloat</span>)leadSpacing tailSpacing:(<span class="built_in">CGFloat</span>)tailSpacing;</span><br></pre></td></tr></table></figure><p>ä¹Ÿæ˜¯é€šè¿‡è®¡ç®—å¹¶å¯¹æ¯ä¸€ä¸ª view è°ƒç”¨ <code>mas_makeConstraints</code>ã€‚ä½†æˆ‘ç›®å‰æ„Ÿè§‰ä¸å¦‚ä½¿ç”¨ <a href="https://nshipster.com/uistackview/"><code>UIStackView</code></a>ï¼Œå¹¶å°† distribution è®¾ç½®ä¸º <code>UIStackViewDistributionEqualSpacing</code> å’Œ <code>UIStackViewDistributionFillEqually</code>ã€‚</p><blockquote><p>ä¸è¿‡ stack view <a href="https://github.com/layoutBox/LayoutFrameworkBenchmark">æ€§èƒ½ç›¸å¯¹äº autolayout ä¼šç¨å¾®å·®ä¸€ç‚¹</a>ï¼Œä½†å¦‚æœåªæœ‰å‡ ä¸ª view æ„Ÿè§‰é—®é¢˜ä¸æ˜¯å¾ˆå¤§ã€‚</p></blockquote><blockquote><p>To be on the safe side, avoid using deeply nested stack views, especially in reusable views such as table and collection view cells. (See <a href="https://nshipster.com/uistackview/">nshipster</a>)</p></blockquote><h3 id="NSArray-MASShorthandAdditions"><a href="#NSArray-MASShorthandAdditions" class="headerlink" title="NSArray+MASShorthandAdditions"></a>NSArray+MASShorthandAdditions</h3><p>ä¸ UIView+MASShorthandAdditions ç±»ä¼¼ï¼Œæä¾›äº†åœ¨å®šä¹‰ <code>MAS_SHORTHAND</code> å®å‰æä¸‹ï¼Œå¯ä»¥åœ¨ <code>NSArray</code> ä¸Šè°ƒç”¨ <code>makeConstraints</code> æ¥ä»£æ›¿è°ƒç”¨ <code>mas_makeConstraints</code>ï¼Œè°ƒç”¨ <code>updateConstraints</code> æ¥ä»£æ›¿ <code>mas_updateConstraints</code> å’Œè°ƒç”¨ <code>remakeConstraints</code> æ¥ä»£æ›¿ <code>mas_remakeConstraints</code> çš„èƒ½åŠ›ã€‚</p><h3 id="MASViewAttribute"><a href="#MASViewAttribute" class="headerlink" title="MASViewAttribute"></a>MASViewAttribute</h3><p>ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹çš„ä¸€äº›å±æ€§ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  The view which the reciever relates to. Can be nil if item is not a view.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>, <span class="keyword">readonly</span>) MAS_VIEW *view;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  The item which the reciever relates to.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>, <span class="keyword">readonly</span>) <span class="type">id</span> item;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  The attribute which the reciever relates to</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>, <span class="keyword">readonly</span>) <span class="built_in">NSLayoutAttribute</span> layoutAttribute;</span><br></pre></td></tr></table></figure><p><code>MAS_View</code> å®é™…ä¸Šæ˜¯ä¸€ä¸ª <code>UIView</code> çš„åˆ«åï¼Œå› æ­¤è¯¥ç±»å®é™…ä¸Šå°è£…äº†ä¸€ä¸ª view å’Œä¸€ä¸ª attributeï¼Œå¯¹åº”äº†æ–‡ç« å¼€å¤´ä¸­è‡ªåŠ¨å¸ƒå±€å…¬å¼ä¸­çš„ä¸€ç»„ <code>Item&#39;s Attribute</code>ã€‚</p><h3 id="MASConstraint"><a href="#MASConstraint" class="headerlink" title="MASConstraint"></a>MASConstraint</h3><p>ä»£è¡¨äº†ä¸€ä¸ªæœªæ¿€æ´»çš„ constraintï¼Œè¯¥ç±»ä¸­æä¾›äº†è¯¸å¦‚ topï¼Œleft ç­‰æ–¹æ³•ï¼Œä½†å…¶åŠŸèƒ½éƒ½éœ€è¦åœ¨å­ç±»ä¸­å®ç°ã€‚è¯¦ç»†è°ƒç”¨é€»è¾‘å¯ä»¥å‚è€ƒåé¢çš„å®ä¾‹åˆ†æéƒ¨åˆ†ã€‚</p><h3 id="MASConstraintMaker"><a href="#MASConstraintMaker" class="headerlink" title="MASConstraintMaker"></a>MASConstraintMaker</h3><p>æä¾›äº†ä¸€ä¸ª <code>install</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å®é™…ä¸Šè°ƒç”¨äº†è‡ªå·±æ¯ä¸ª <code>MASConstraint</code> çš„ <code>install</code> æ–¹æ³•ï¼Œå¦‚æœ <code>removeExisting</code> æ˜¯ YESï¼Œå…ˆ <code>uninstall</code> å­˜åœ¨çš„ constraintsï¼Œå¦‚æœ <code>updateExisting</code> æ˜¯ YESï¼ŒæŠŠæ¯ä¸ª constraints çš„ updateExisting è®¾ç½®ä¸º YES.</p><p>Maker çš„å±æ€§å¦‚ left è°ƒç”¨çš„æ—¶å€™éƒ½ç›¸å½“äºæŠŠå¯¹åº”çš„ attribute æ·»åŠ åˆ° maker çš„ constraints æ•°ç»„é‡Œé¢ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ª MASConstraintsã€‚</p><p>å•ä¸ªå±æ€§è¿”å›çš„æ˜¯ä¸€ä¸ª <code>MASViewConstraint</code>ï¼Œè€Œç»„åˆå±æ€§å¦‚ edges è¿”å›çš„æ˜¯ä¸€ä¸ª <code>MASCompositeConstraint</code>ã€‚è¿™ä¸¤ä¸ªéƒ½æ˜¯ <code>MASConstraints</code> çš„å­ç±»ã€‚å®ç°äº† <code>addConstraintWithLayoutAttribute</code> æ–¹æ³•å’Œä¸€äº›å…¶ä»–é‡è¦æ–¹æ³•æ¯”å¦‚ <code>install</code>ã€‚</p><p>å…·ä½“ä½¿ç”¨é€»è¾‘å¯ä»¥å‚è€ƒåé¢çš„å®ä¾‹åˆ†æéƒ¨åˆ†ã€‚</p><h3 id="MASViewConstraint"><a href="#MASViewConstraint" class="headerlink" title="MASViewConstraint"></a>MASViewConstraint</h3><p>ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸€äº›é‡è¦å±æ€§ã€‚</p><p>å¤´æ–‡ä»¶é‡ŒåŒ…æ‹¬ä¸¤ä¸ª <code>MASViewAttribute</code>ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  First item/view and first attribute of the NSLayoutConstraint</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) MASViewAttribute *firstViewAttribute;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  Second item/view and second attribute of the NSLayoutConstraint</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) MASViewAttribute *secondViewAttribute;</span><br></pre></td></tr></table></figure><p>.h æ–‡ä»¶ä¸­çš„ä¸€äº›å±æ€§ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) MAS_VIEW *installedView;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) MASLayoutConstraint *layoutConstraint;</span><br><span class="line"><span class="comment">/// ä¸¤ä¸ª attribute ä¹‹é—´çš„å…³ç³»ï¼Œå¯èƒ½æ˜¯ç­‰äºï¼Œå°äºç­‰äºï¼Œå¤§äºç­‰äº</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">NSLayoutRelation</span> layoutRelation;</span><br><span class="line"><span class="comment">/// é™åˆ¶çš„ä¼˜å…ˆåº¦ï¼Œé»˜è®¤æ˜¯ MASLayoutPriorityRequired</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) MASLayoutPriority layoutPriority;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> layoutMultiplier;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> layoutConstant;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="type">BOOL</span> hasLayoutRelation;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="type">id</span> mas_key;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="type">BOOL</span> useAnimator;</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–æ–¹æ³•åœ¨ <code>MASConstraintMaker</code> è¢«è°ƒç”¨ï¼Œç”¨æ¥æ·»åŠ çº¦æŸï¼Œçº¦æŸé»˜è®¤çš„ <a href="https://developer.apple.com/documentation/uikit/uilayoutpriority?language=objc">priority</a> éƒ½æ˜¯ <code>MASLayoutPriorityRequired</code>ã€‚multipler éƒ½æ˜¯ 1ã€‚</p><ul><li><code>left</code> å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ delegate çš„ <code>- (MASConstraint *)constraint:(MASConstraint *)constraint addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute</code> æ–¹æ³•ï¼Œdelegate æ˜¯ <code>MASConstraintMaker</code>ã€‚é‡Œé¢æŠŠè¿™ä¸ªæ–°çš„çº¦æŸåŠ åˆ°äº† maker çš„ constraints æ•°ç»„é‡Œé¢çš„ã€‚</li><li><code>equalTo</code>ï¼Œ<code>greaterThanOrEqualTo</code> å’Œ <code>lessThanOrEqualTo</code> éƒ½è°ƒç”¨äº† <code>equalToWithRelation</code>ï¼Œä½†ä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°ï¼ˆlayoutRelationï¼‰ä¸ä¸€æ ·ï¼Œè¿™ä¸ªä¹Ÿæ˜¯åœ¨å­ç±»é‡Œé¢è¢«å®ç°çš„ã€‚<code>equalTo</code> åé¢å—¯èƒ½ç”¨æ‹¬å·æ˜¯å› ä¸ºè¿”å›çš„æ˜¯ä¸€ä¸ª blockã€‚å¦‚æœä¼ å…¥çš„æ˜¯ä¸€ä¸ª viewï¼Œè®¾ç½®è‡ªå·±çš„ layoutRelation æ˜¯ relationï¼ŒsecondAttribute æ˜¯é‚£ä¸ªä¼ å…¥çš„ viewï¼ˆå¦‚æœä¼ å…¥çš„æ˜¯ä¸€ä¸ª NSValue æˆ–è€… CGPointï¼ŒCGSizeï¼Œå°†ä¼šå…ˆçœ‹ attribute ç¬¦ä¸ç¬¦åˆï¼Œç„¶åæ›´æ”¹ layoutConstantï¼‰ã€‚å¦‚æœä¼ å…¥çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¼šè½¬æ¢æˆä¸€ä¸ª <code>MASCompositeConstraint</code>ã€‚</li><li><code>insets</code> è¦ä¼ å…¥ä¸€ä¸ª UIEdgeInset å‚æ•°ï¼Œå°†ä¼šå§ firstAttribute é‡Œé¢çš„å¯¹åº”å‚æ•°å˜æˆ edgeInset é‡Œé¢çš„å€¼ã€‚<code>inset</code> å®é™…è°ƒç”¨äº†ä¸€ä¸ª <code>insets</code> å¹¶å°† 4 é¢éƒ½è®¾ç½®ä¸ºä¼ å…¥çš„å€¼ã€‚<code>offset</code> æ›´æ”¹äº† <code>layoutConstant</code> å€¼ã€‚<code>mas_offset</code> å’Œä¹‹å‰çš„ <code>equalTo</code> ä¸€æ ·å¢åŠ äº† auto boxingï¼Œå¯¹äºä¼ å…¥ view å’Œ number æœ‰ä¸åŒçš„å¤„ç†ã€‚</li><li><code>with</code> å’Œ <code>and</code> éƒ½ç›´æ¥è¿”å› <code>self</code> åªæ˜¯ä¸ºäº†å¸®åŠ©é“¾å¼è°ƒç”¨çš„è¯»æ³•æ›´åŠ é€šé¡ºã€‚å¦‚ <code>make.width.and.height.equalTo(self.bottomView).with.priorityLow();</code>ï¼Œå®é™…ä½¿ç”¨æ—¶å¯ä»¥ä¸å†™ã€‚</li><li><code>priorityLow</code> å®é™…ä¸Šè°ƒç”¨äº† <code>.priority</code> å¹¶å°†å¯¹åº”çš„ä¼˜å…ˆçº§ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚</li></ul><p>å…·ä½“å¦‚ä½•è¢«è°ƒç”¨å¯ä»¥å‚è€ƒåæ–‡ä¸­çš„æ¡ˆä¾‹åˆ†æ1å’Œ2ã€‚</p><h3 id="MASCompositeConstraint"><a href="#MASCompositeConstraint" class="headerlink" title="MASCompositeConstraint"></a>MASCompositeConstraint</h3><p>åŒ…å«å¤šä¸ª <code>MASViewConstraint</code> çš„ä¸€ä¸ª constraintï¼Œä¼šåœ¨é“¾å¼è°ƒç”¨åŒæ—¶è®¾ç½®å¤šä¸ª attribute æ—¶è¢«åˆ›å»ºï¼Œå¦‚ <code>make.left.and.right.equalTo(view).offset(@10)</code>ã€‚å¯¹äºçˆ¶ç±»ä¸­çš„æ–¹æ³•å®ç°åŸºæœ¬å°±æ˜¯è°ƒç”¨äº†åŒ…å«çš„æ¯ä¸€ä¸ª <code>MASViewConstraint</code> çš„åŒåæ–¹æ³•ã€‚</p><p>å…·ä½“å¦‚ä½•è¢«ç”Ÿæˆå¯ä»¥å‚è€ƒåæ–‡ä¸­çš„æ¡ˆä¾‹åˆ†æ3ã€‚</p><h3 id="å®ä¾‹åˆ†æ"><a href="#å®ä¾‹åˆ†æ" class="headerlink" title="å®ä¾‹åˆ†æ"></a>å®ä¾‹åˆ†æ</h3><h4 id="æ¡ˆä¾‹1"><a href="#æ¡ˆä¾‹1" class="headerlink" title="æ¡ˆä¾‹1"></a>æ¡ˆä¾‹1</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[view1 mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">    make.top.mas_equalTo(view2).mas_offset(<span class="number">10</span>);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure><p><code>mas_makeConstraints</code> çš„è°ƒç”¨ï¼Œåˆ›å»ºäº†ä¸€ä¸ª <code>MASConstraintMaker</code> å®ä¾‹ï¼Œå¹¶ä¸”å°†å…¶ <code>view</code> å±æ€§è®¾ç½®ä¸º <code>view1</code>ã€‚ç„¶åå°†è¯¥æ–°å»ºçš„ maker ä½œä¸ºå‚æ•°ä¼ å…¥åˆ° block ä¸­ï¼Œè°ƒç”¨æ•´ä¸ª blockã€‚</p><p>è°ƒç”¨ <code>.top</code> åˆ†åˆ«åˆ›å»ºäº†ä¸€ä¸ª attribute å’Œä¸€ä¸ª constraints</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MASViewAttribute *viewAttribute = [[MASViewAttribute alloc] initWithView:<span class="keyword">self</span>.view layoutAttribute:layoutAttribute];</span><br><span class="line">MASViewConstraint *newConstraint = [[MASViewConstraint alloc] initWithFirstViewAttribute:viewAttribute];</span><br></pre></td></tr></table></figure><p>å¹¶å°†è¿™ä¸ª newConstraint çš„ delegate è®¾ç½®æˆ makerï¼Œå†å°†å…¶åŠ å…¥åˆ° maker çš„ <code>constraints</code> æ•°ç»„ä¸­ã€‚å¹¶è¿”å›ä¸€ä¸ª <code>MASViewConstraints</code>ï¼Œè¿”å›çš„å°±æ˜¯ <code>newConstraint</code>ï¼Œä¹Ÿå°±æ˜¯è¯´åé¢çš„é“¾å¼æ“ä½œå®é™…ä¸Šéƒ½æ˜¯åœ¨å¯¹ä¸€ä¸ªå·²åŠ å…¥åˆ° constraints æ•°ç»„çš„è¿›è¡Œä¿®æ”¹ã€‚</p><p><code>mas_equalTo</code> è°ƒç”¨äº† <code>MASViewConstraints</code> çš„ <code>equalToWithRelation</code> æ–¹æ³•ï¼Œå…¶ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª <code>id</code> ç±»å‹ï¼Œè¿™é‡Œå°† <code>view2</code> ä½œä¸ºè¿™ä¸ªå‚æ•°ä¼ å…¥ã€‚æ–¹æ³•ä¸­å°†ä¼šå°† constraints çš„ <code>layoutRelation</code> è®¾ç½®ä¸ºå¯¹åº”çš„ relationï¼Œè¿™é‡Œæ˜¯ <code>NSLayoutRelationEqual</code>ã€‚å¹¶ä¸”ä¼ å…¥ <code>view2</code> æ¥è®¾ç½® constraints çš„ <code>secondAttribute</code> å±æ€§ã€‚åœ¨ setter ä¸­ï¼Œæ–°ç”Ÿæˆä¸€ä¸ª <code>MASViewAttribute</code>ï¼Œè¯¥ <code>MASViewAttribute</code> çš„ <code>view</code> å°±æ˜¯ view2ï¼Œè€Œ <code>attribute</code> å’Œ view1 çš„ attribute ç›¸åŒã€‚æœ€åä¹ŸåŒæ ·ä¼šè¿”å›ä¸€ä¸ª <code>MASConstraint</code>ã€‚</p><blockquote><p>å¦‚æœ <code>equalTo</code> é‡Œé¢æ˜¯ä¸€ä¸ªæ•°å­—å°±ä¼šç›´æ¥å»è®¾ç½® constraints çš„ layoutConstantã€‚</p></blockquote><p><code>mas_offset</code> ä¼šæŠŠ <code>MASConstraint</code> çš„ offset è®¾ç½®ä¸º 10ï¼Œoffset çš„ setter æ–¹æ³•ä¼šå°† <code>layoutConstant</code> è®¾ç½®ä¸ºè¯¥å¸¸æ•°ï¼Œä¹‹åä»ä¼šè¿”å›ä¸€ä¸ª <code>MASConstraint</code>ï¼Œä½†åˆ°äº†æ­¤æ—¶ï¼Œä¸€ä¸ª <code>MASConstraint</code> çš„æ‰€æœ‰å±æ€§å·²ç»è®¾ç½®å®Œæˆ.</p><h4 id="æ¡ˆä¾‹2"><a href="#æ¡ˆä¾‹2" class="headerlink" title="æ¡ˆä¾‹2"></a>æ¡ˆä¾‹2</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[view1 mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">    make.top.mas_equalTo(view2.mas_bottom).mas_offset(<span class="number">10</span>);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure><p>å’Œä¸Šé¢åŸºæœ¬ä¸€æ ·ï¼Œä½†æ­¤æ—¶è®¾ç½® <code>secondAttribute</code> çš„æ—¶å€™ä¼ å…¥çš„æ˜¯ä¸€ä¸ª <code>MASAttribute</code>ï¼Œè¿™ä¸ª attribute çš„ <code>view</code> å’Œ <code>item</code> å±æ€§éƒ½åˆå§‹åŒ–ä¸º <code>view2</code>ï¼ŒåŒæ—¶ <code>layoutAttribute</code> å±æ€§è¢«è®¾ç½®ä¸º <code>NSLayoutAttributeBottom</code>ã€‚<code>secondAttribute</code> è¢«ç›´æ¥è®¾ç½®ä¸ºè¿™ä¸ª attributeã€‚</p><h4 id="æ¡ˆä¾‹3"><a href="#æ¡ˆä¾‹3" class="headerlink" title="æ¡ˆä¾‹3"></a>æ¡ˆä¾‹3</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[view1 mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">    make.leading.and.trailing.mas_equalTo(view2.mas_bottom).inset(<span class="number">10</span>);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure><p><code>make.leading.and</code> å’Œä¸Šé¢ä¸€æ ·ï¼Œå¾€ maker çš„ constraints æ•°ç»„é‡Œé¢æ·»åŠ äº†ä¸€ä¸ª constraintsã€‚<code>MASConstraints</code> çš„ <code>.trailing</code> ä¼šè°ƒç”¨å…¶ <code>addConstraintWithLayoutAttribute</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨å­ç±»ä¸­è¢«å®ç°ï¼Œ<code>MASViewConstraints</code>  çš„è¯¥æ–¹æ³•è°ƒç”¨äº†å…¶ delegate çš„ <code>- (MASConstraint *)constraint:(MASConstraint *)constraint addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute</code> æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ <code>MASConstraintMaker</code> çš„è¯¥æ–¹æ³•ã€‚ä½†å’Œæœ€å¼€å§‹ <code>make.leading</code> è°ƒç”¨æ‰€ä¸åŒçš„æ˜¯ï¼Œä¹‹å‰çš„ç¬¬ä¸€ä¸ªå‚æ•° constraint ä¼ çš„æ˜¯ <code>nil</code>ï¼Œç°åœ¨ä¼ çš„æ˜¯ <code>self</code> ä¹Ÿå°±æ˜¯ <code>make.leading</code> ç”Ÿæˆçš„ <code>MASConstraint</code>ã€‚æ­¤æ—¶ä¼šå°†ä¸¤ä¸ª constraints åˆæˆä¸€ä¸ª <code>MASCompositeConstraint</code>ï¼Œè¯¥ç±»æ˜¯ <code>MASConstraints</code>  çš„å¦ä¸€ä¸ªå­ç±»ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSArray</span> *children = @[constraint, newConstraint];</span><br><span class="line">MASCompositeConstraint *compositeConstraint = [[MASCompositeConstraint alloc] initWithChildren:children];</span><br><span class="line">compositeConstraint.delegate = <span class="keyword">self</span>;</span><br><span class="line">[<span class="keyword">self</span> constraint:constraint shouldBeReplacedWithConstraint:compositeConstraint];</span><br><span class="line"><span class="keyword">return</span> compositeConstraint;</span><br></pre></td></tr></table></figure><p><code>MASCompositeConstraint</code> çš„åˆå§‹åŒ–æ–¹æ³•ä¸­ï¼Œå°†ä¼šæŠŠæ‰€æœ‰çš„ children ä¸­çš„ constraint çš„ delegate è®¾ç½®ä¸º compositeConstraint è‡ªèº«ã€‚</p><p><code>shouldBeReplacedWithConstraint</code> ä¸­å°†ä¼šæŠŠ maker ä¸­çš„ constraints å±æ€§ä¸­çš„ <code>constraint</code> æ›¿æ¢æˆ <code>compositionConstraint</code>ã€‚</p><p>æœ€åä¸€ä¸ª <code>MASCompositeConstraints</code> å°†ä¼šè¢«è¿”å›ã€‚</p><p>å¦‚æœæˆ‘ä»¬ç»§ç»­æ·»åŠ å±æ€§ï¼Œæ¯”å¦‚åœ¨ <code>trailing</code> åæ·»åŠ  <code>.bottom</code>ï¼Œæ­¤æ—¶è°ƒç”¨çš„æ˜¯ <code>MASCompositeConstraint</code> çš„ <code>addConstraintWithLayoutAttribute</code> çš„æ–¹æ³•ã€‚é‡Œé¢è°ƒç”¨äº† <code>MASConstraintsMaker</code> çš„ <code>[strongDelegate constraint:self addConstraintWithLayoutAttribute:layoutAttribute]</code> æ–¹æ³•ï¼ˆ<code>strongDelegate</code> å°±æ˜¯ compositeConstraints çš„ delegateï¼Œä¹Ÿå°±æ˜¯ makerã€‚ç”±äºç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯ä¸€ä¸ª <code>nil</code> ä¹Ÿä¸æ˜¯ <code>viewConstraints</code>ï¼Œä¼šç›´æ¥è¿”å›ä¸€ä¸ª <code>MASConstraint</code> å¹¶è¢« <code>MASCompositeConstraints</code> åŠ å…¥åˆ° children æ•°ç»„ä¸­ã€‚</p><p><code>MASCompositeConstraints</code> çš„ <code>inset</code> æˆ–è€… <code>offset</code> æ–¹æ³•ä¼šéå†æ‰€æœ‰çš„ children ä¸­çš„å¹¶è°ƒç”¨å¯¹åº”çš„æ–¹æ³•ï¼ˆ<code>inset</code> æˆ–è€… <code>offset</code>ï¼‰æœ€ç»ˆå…¶å®å’Œä¹‹å‰çš„ mas_offset ä¸€æ ·éƒ½æ˜¯å¯¹ constraint çš„ layoutConstant å±æ€§è¿›è¡Œäº†è®¾ç½®ï¼Œinset åªæ˜¯å¸®ä½ åœ¨ bottomï¼Œtrailing å’Œ bottom çš„æƒ…å†µä¸‹åŠ ä¸Šäº†è´Ÿå·ã€‚</p><h4 id="æœ€åæ­¥éª¤"><a href="#æœ€åæ­¥éª¤" class="headerlink" title="æœ€åæ­¥éª¤"></a>æœ€åæ­¥éª¤</h4><p>ä¸Šé¢ä¸‰ä¸ªæ¡ˆä¾‹çš„ block æ‰§è¡Œç»“æŸåéƒ½ä¼šè°ƒç”¨ maker çš„ <code>install</code> æ–¹æ³•ã€‚å…¶å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSArray</span> *)install &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.removeExisting) &#123;</span><br><span class="line">        <span class="built_in">NSArray</span> *installedConstraints = [MASViewConstraint installedConstraintsForView:<span class="keyword">self</span>.view];</span><br><span class="line">        <span class="keyword">for</span> (MASConstraint *constraint <span class="keyword">in</span> installedConstraints) &#123;</span><br><span class="line">            [constraint uninstall];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSArray</span> *constraints = <span class="keyword">self</span>.constraints.copy;</span><br><span class="line">    <span class="keyword">for</span> (MASConstraint *constraint <span class="keyword">in</span> constraints) &#123;</span><br><span class="line">        constraint.updateExisting = <span class="keyword">self</span>.updateExisting;</span><br><span class="line">        [constraint install];</span><br><span class="line">    &#125;</span><br><span class="line">    [<span class="keyword">self</span>.constraints removeAllObjects];</span><br><span class="line">    <span class="keyword">return</span> constraints;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>removeExisting</code> å’Œ <code>updateExisting</code> ä¼šåœ¨è°ƒç”¨ <code>mas_remakeConstraints</code> å’Œ <code>mas_updateConstraints</code> çš„æ—¶å€™è¢«è®¾ç½®ã€‚å¯ä»¥çœ‹åˆ° install å°±æ˜¯éå†è‡ªå·±çš„ constraints æ•°ç»„ï¼ˆéƒ½æ˜¯åœ¨ block é‡Œé¢æ·»åŠ çš„ï¼‰ï¼Œå¹¶å¯¹é‡Œé¢çš„æ¯ä¸€ä¸ª constraint è°ƒç”¨ install æ–¹æ³•ï¼ˆè¯¥æ–¹æ³•éƒ½åœ¨å­ç±»é‡Œé¢å®ç°ï¼‰ã€‚</p><p><code>MASViewConstraints</code> å¯¹äº install çš„å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>åˆ†åˆ«æ‹¿å‡º firstAttribute å’Œ secondAttribute ä¸­çš„ itemï¼ˆitem1ï¼Œitem2ï¼‰ å’Œ attributeï¼ˆattribute1ï¼Œattribute2ï¼‰ï¼Œå¦‚æœ second attribute ä¸º nilï¼ˆæ¯”å¦‚ <code>make.left.equalTo(@10)</code>)ï¼Œä¼šå°† item2 è®¾ç½®ä¸º item1 çš„ superviewï¼Œattribute2 è®¾ç½®ä¸º attribute1ã€‚</li><li>è°ƒç”¨ç³»ç»Ÿæ–¹æ³•è·å¾—ä¸€ä¸ª layout constraints</li></ol><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MASLayoutConstraint *layoutConstraint <span class="comment">// MASLayoutConstraint æ˜¯ä¸€ä¸ª NSLayoutConstraint çš„å­ç±»</span></span><br><span class="line">        = [MASLayoutConstraint constraintWithItem:firstLayoutItem</span><br><span class="line">                                        attribute:firstLayoutAttribute</span><br><span class="line">                                        relatedBy:<span class="keyword">self</span>.layoutRelation</span><br><span class="line">                                           toItem:secondLayoutItem</span><br><span class="line">                                        attribute:secondLayoutAttribute</span><br><span class="line">                                       multiplier:<span class="keyword">self</span>.layoutMultiplier</span><br><span class="line">                                         constant:<span class="keyword">self</span>.layoutConstant];</span><br><span class="line">layoutConstraint.priority = <span class="keyword">self</span>.layoutPriority;</span><br></pre></td></tr></table></figure><ol start="3"><li>æŸ¥æ‰¾è¿™ä¸ª constraints çš„ installedViewï¼ˆè¢«æ·»åŠ åˆ°çš„ view ä¸Šï¼Œå¦‚æœ item1ï¼Œitem2éƒ½æ˜¯ viewï¼Œé‚£å°±æ˜¯ä»–ä»¬å…±åŒçš„ superviewï¼Œä»è¿™ä¸€ç‚¹ä¹Ÿå¯ä»¥çœ‹å‡ºåªæœ‰æ‹¥æœ‰åŒä¸€ä¸ª superview çš„ä¸¤ä¸ª view ä¹‹é—´æ‰èƒ½æ·»åŠ å±æ€§çº¦æŸï¼ˆåŒ…æ‹¬ä¸€ä¸ªæ˜¯å¦ä¸€ä¸ªçš„ superviewï¼‰ï¼›å¦‚æœ attribute1 æ˜¯æŸç§ size å±æ€§ï¼Œé‚£å°±æ˜¯ item1ï¼›å¦‚æœ item2 ä¸å­˜åœ¨é‚£å°±æ˜¯ item1 çš„çˆ¶ viewï¼‰æ˜¯å¦æœ‰ç›¸åŒçš„ layoutConstraint</li></ol><p>å¦‚æœå­˜åœ¨åŒæ ·çš„ layoutConstraintï¼Œå°±æ›´æ–°å¯¹åº”çš„ layoutConstraintï¼Œå› æ­¤ä½¿ç”¨ <code>mas_updateConstraints</code> è¦æ³¨æ„åªèƒ½å¸®ä½ æ›´æ–°åªä¿®æ”¹ constant çš„ constraintã€‚</p><blockquote><p>è¦æ±‚è¯¥ constraint çš„ firstItem, secondItem, firstAttribute, secondAttribute, relation, multiplier, priority ä¸€æ ·ã€‚</p></blockquote><ol start="4"><li>å¦‚æœæ²¡æœ‰ç›¸åŒçš„ constraints å°±å¯¹è¯¥ constraints è¿›è¡Œæ¿€æ´»ã€‚</li></ol><p><code>MASCompositeConstraint</code> çš„ <code>install</code> å®é™…ä¸Šå°±æ˜¯éå† children é‡Œé¢çš„æ‰€æœ‰ constraints å¹¶è°ƒç”¨å…¶ install æ–¹æ³•ã€‚</p><h4 id="æ¡ˆä¾‹æ€»ç»“"><a href="#æ¡ˆä¾‹æ€»ç»“" class="headerlink" title="æ¡ˆä¾‹æ€»ç»“"></a>æ¡ˆä¾‹æ€»ç»“</h4><ul><li><code>mas_makeConstraints</code> block ä¸­çš„ä¸€æ¡è¯­å¥ä¼šç”Ÿæˆä¸€ä¸ª <code>MASConstraints</code> çš„å­ç±»ï¼Œå¦‚æœæ˜¯å•ä¸ªçº¦æŸä¼šç”Ÿæˆä¸€ä¸ª <code>MASViewConstraints</code>ï¼Œå¦‚æœæ˜¯å¤šä¸ªçº¦æŸä¼šç”Ÿæˆä¸€ä¸ª <code>MASCompositeConstraint</code>ï¼ˆå®é™…å†…éƒ¨è¿˜æ˜¯åŒ…æ‹¬äº†å¾ˆå¤šä¸ª <code>MASViewConstraints</code>ï¼‰ã€‚</li><li><code>view.mas_top</code> è¿™æ ·çš„è¯­å¥è¿”å›çš„æ˜¯ä¸€ä¸ª <code>MASAttribute</code>ã€‚</li></ul><h3 id="å…¶ä»–é—®é¢˜"><a href="#å…¶ä»–é—®é¢˜" class="headerlink" title="å…¶ä»–é—®é¢˜"></a>å…¶ä»–é—®é¢˜</h3><h4 id="ä½¿ç”¨-inset-è¿˜æ˜¯-mas-offset"><a href="#ä½¿ç”¨-inset-è¿˜æ˜¯-mas-offset" class="headerlink" title="ä½¿ç”¨ inset è¿˜æ˜¯ mas_offset"></a>ä½¿ç”¨ <code>inset</code> è¿˜æ˜¯ <code>mas_offset</code></h4><p>å®é™…å®ç°éƒ½æ˜¯ä¸€æ ·çš„ï¼Œéƒ½è®¾ç½®äº† constraint çš„ layoutConstant å±æ€§ï¼Œä½† <code>inset</code> ä¼šåœ¨ trailingï¼Œright å’Œ bottom çš„æ—¶å€™æ·»åŠ è´Ÿå·ã€‚</p><h4 id="mas-equalTo-å’Œ-equalTo"><a href="#mas-equalTo-å’Œ-equalTo" class="headerlink" title="mas_equalTo å’Œ equalTo"></a><code>mas_equalTo</code> å’Œ <code>equalTo</code></h4><p><code>mas_equalTo</code> æ˜¯ä¸€ä¸ªå®šä¹‰çš„å®ï¼Œå°†ä¼šå¯¹ä¼ å…¥å€¼è¿›è¡Œ autoboxing æˆ <code>NSNumber</code>ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> mas_equalTo(...)                 equalTo(MASBoxValue((__VA_ARGS__)))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MASBoxValue(value) _MASBoxValue(@encode(__typeof__((value))), (value)) <span class="comment">// In MASUtilities.h</span></span></span><br></pre></td></tr></table></figure><p><a href="https://nshipster.cn/type-encodings/"><code>@encode</code></a> å¾—åˆ°å€¼çš„ç±»å‹ï¼Œé€šè¿‡å¯å˜å‚æ•°åˆ—è¡¨ï¼Œä½¿ç”¨ <code>strcmp</code> å¯¹æ¯”å‚æ•°å’Œç±»å‹ï¼Œç›¸åŒæ—¶å°±å°†å‚æ•°è½¬æ¢æˆè¯¥ç±»å‹ã€‚</p><blockquote><p><code>MASConstraint (AutoboxingSupport)</code> ä¸­ä¹Ÿå®šä¹‰äº†ä¸€ä¸ª <code>mas_equal</code> ï¼‰å°†å…¶å®ç°ä¸ºå’Œ <code>equalTo</code> ä¸€è‡´ã€‚å®é™…è°ƒç”¨çš„æ—¶å€™éƒ½æ˜¯ç”¨çš„å®ï¼Œæ·»åŠ ä¸€ä¸ªåŒåçš„æ–¹æ³•èƒ½å¤Ÿä½¿å®èƒ½å¤Ÿæœ‰è‡ªåŠ¨è¡¥å…¨çš„èƒ½åŠ›ã€‚</p></blockquote><h4 id="ä½¿ç”¨-trailing-è¿˜æ˜¯-right"><a href="#ä½¿ç”¨-trailing-è¿˜æ˜¯-right" class="headerlink" title="ä½¿ç”¨ trailing è¿˜æ˜¯ right"></a>ä½¿ç”¨ <code>trailing</code> è¿˜æ˜¯ <code>right</code></h4><p>å¤§å¤šæ•°æƒ…å†µä¸‹å«ä¹‰ä¸€æ ·ï¼Œä½†è¦æ³¨æ„å¯¹äºä¸€äº›ä»å³åˆ°å·¦çš„è¯­è¨€ï¼Œæ¯”å¦‚é˜¿æ‹‰ä¼¯è¯­ï¼Œ<code>trailing</code> å®é™…ä»£è¡¨çš„æ˜¯ <code>left</code>ã€‚åŸºæœ¬ä¸Šä½¿ç”¨ <code>trailing</code> æ€»æ˜¯æ›´ä¿é™©çš„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç®€å•ä»‹ç»äº†ä¸€äº›å…³äº iOS è‡ªåŠ¨å¸ƒå±€çš„æ¦‚å¿µï¼Œå¹¶å¯¹ Masonry æ¡†æ¶è¿›è¡Œäº†åˆ†æã€‚ä¸»è¦ä»‹ç»äº† Masonry æ¡†æ¶ä¸»è¦ç»“æ„ï¼Œä½¿ç”¨æ—¶å†…éƒ¨è°ƒç”¨è¿‡ç¨‹å’Œä¸€äº›éœ€è¦æ³¨æ„çš„ç»†èŠ‚ã€‚&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
</feed>
